<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-x32.ico"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-x16.ico"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta name="google-site-verification" content="veaTBtqt4ArdFO7yL4lECMYJsOeSwdptb1k8vJJBzMA"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css"><script src="/lib/pace/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://lyreal666.com").hostname,root:"/",scheme:"Pisces",version:"7.7.1",exturl:!0,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!0,style:"default"},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!0,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="æœ¬ç¯‡ä¸º ä»é›¶å¼€å§‹é…ç½® react + typescript ç³»åˆ—ç¬¬ä¸‰ç¯‡ï¼Œå°†å¸¦å¤§å®¶å®Œæˆæ¨¡æ¿é¡¹ç›®çš„ webpack é…ç½®ã€‚æ•´ä¸ªé¡¹ç›®çš„é…ç½®æˆ‘åŠ›æ±‚è¾¾åˆ°ä»¥ä¸‹ç›®æ ‡ï¼šçµæ´»ï¼š æˆ‘åœ¨é…ç½® eslint æ˜¯é€‰æ‹©ä½¿ç”¨ js æ ¼å¼è€Œä¸æ˜¯ jsonï¼Œå°±æ˜¯ä¸ºäº†çµæ´»æ€§ï¼Œä½¿ç”¨ js æ–‡ä»¶å¯ä»¥è®©ä½ ä½¿ç”¨å¯¼å…¥å…¶å®ƒæ¨¡å—ï¼Œæ ¹æ®å¼€å‘ç¯å¢ƒåŠ¨æ€é…ç½®ï¼Œå……åˆ†å‘æŒ¥ js è¯­è¨€çš„èƒ½åŠ›ã€‚æ–°æ½®ï¼š æˆ‘è§‰å¾—æ—¶åˆ»ä¿æŒå¯¹æ–°äº‹ç‰©çš„å…³æ³¨å’Œå°è¯•å»ä½¿ç”¨å®ƒæ˜¯ä¸€ä¸ªä¼˜ç§€çš„ç´ è´¨ã€‚"><meta property="og:type" content="article"><meta property="og:title" content="ä»é›¶å¼€å§‹é…ç½® react + typescriptï¼ˆä¸‰ï¼‰ï¼šwebpack"><meta property="og:url" content="https://lyreal666.com/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E9%85%8D%E7%BD%AE-react-typescript%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9Awebpack/index.html"><meta property="og:site_name" content="ä½™è…¾é–çš„åšå®¢"><meta property="og:description" content="æœ¬ç¯‡ä¸º ä»é›¶å¼€å§‹é…ç½® react + typescript ç³»åˆ—ç¬¬ä¸‰ç¯‡ï¼Œå°†å¸¦å¤§å®¶å®Œæˆæ¨¡æ¿é¡¹ç›®çš„ webpack é…ç½®ã€‚æ•´ä¸ªé¡¹ç›®çš„é…ç½®æˆ‘åŠ›æ±‚è¾¾åˆ°ä»¥ä¸‹ç›®æ ‡ï¼šçµæ´»ï¼š æˆ‘åœ¨é…ç½® eslint æ˜¯é€‰æ‹©ä½¿ç”¨ js æ ¼å¼è€Œä¸æ˜¯ jsonï¼Œå°±æ˜¯ä¸ºäº†çµæ´»æ€§ï¼Œä½¿ç”¨ js æ–‡ä»¶å¯ä»¥è®©ä½ ä½¿ç”¨å¯¼å…¥å…¶å®ƒæ¨¡å—ï¼Œæ ¹æ®å¼€å‘ç¯å¢ƒåŠ¨æ€é…ç½®ï¼Œå……åˆ†å‘æŒ¥ js è¯­è¨€çš„èƒ½åŠ›ã€‚æ–°æ½®ï¼š æˆ‘è§‰å¾—æ—¶åˆ»ä¿æŒå¯¹æ–°äº‹ç‰©çš„å…³æ³¨å’Œå°è¯•å»ä½¿ç”¨å®ƒæ˜¯ä¸€ä¸ªä¼˜ç§€çš„ç´ è´¨ã€‚"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://i.loli.net/2020/02/16/QS1lFJt7fbIYEcG.png"><meta property="og:image" content="https://i.loli.net/2020/02/16/PVpnHNC9G7rEtQT.png"><meta property="og:image" content="https://i.loli.net/2020/02/20/lLQEXfwgY5khOeM.png"><meta property="og:image" content="https://github.com/sindresorhus/log-symbols/raw/master/screenshot.png"><meta property="og:image" content="https://i.loli.net/2020/02/16/DevliamMEKy1hTt.gif"><meta property="og:image" content="https://i.loli.net/2020/02/17/kqngMuoNQWj2CyG.png"><meta property="og:image" content="https://camo.githubusercontent.com/cb9c82719765ad966a2771f084175c9ec935124e/687474703a2f2f692e696d6775722e636f6d2f4f495031676e6a2e676966"><meta property="og:image" content="https://i.loli.net/2020/02/16/MvEgi4sw7WkjbnT.png"><meta property="og:image" content="https://i.loli.net/2020/02/19/MGDZLJBcK2yToN6.png"><meta property="og:image" content="https://i.loli.net/2020/02/19/bj9hRKeUBMG1Hmv.png"><meta property="og:image" content="https://i.loli.net/2020/02/19/wsWuPkh3x9GlL4a.png"><meta property="og:image" content="https://i.loli.net/2020/02/16/czN2UDhGiXb3TJ5.png"><meta property="og:image" content="https://i.loli.net/2020/02/16/FWdazBElvG8Mq4U.png"><meta property="og:image" content="https://i.loli.net/2020/04/03/3fLepM1GSBAPjh4.png"><meta property="og:image" content="https://i.loli.net/2020/02/16/bHQEPLK1WiCXlBA.png"><meta property="og:image" content="https://i.loli.net/2020/02/16/VOxjym6zZFftkhr.png"><meta property="og:image" content="https://i.loli.net/2020/02/19/4wW75dVszApkQGe.png"><meta property="og:image" content="https://i.loli.net/2020/02/19/8OnBuWedj5z2CFP.png"><meta property="og:image" content="https://i.loli.net/2020/02/17/ZucCU1dEev372bS.png"><meta property="og:image" content="https://i.loli.net/2020/02/17/q5B6kUFSm3TyiLl.png"><meta property="og:image" content="https://i.loli.net/2020/02/20/Mxsl8rQdU1tNiYm.png"><meta property="og:image" content="https://i.loli.net/2020/02/20/IouO1Kvt5wFAWVl.png"><meta property="og:image" content="https://raw.githubusercontent.com/smooth-code/error-overlay-webpack-plugin/master/docs/example.png"><meta property="og:image" content="https://i.loli.net/2020/02/18/h1njS2olHADUV8R.png"><meta property="og:image" content="https://i.loli.net/2020/02/20/DusmAYnTV2JL4Xv.png"><meta property="og:image" content="https://i.loli.net/2020/02/19/c1vdoqsT34WCSHX.png"><meta property="og:image" content="https://i.loli.net/2020/02/19/Plifd7e9b2WOxsF.png"><meta property="og:image" content="https://i.loli.net/2020/02/19/Oteqp9js3DPFrCS.png"><meta property="og:image" content="https://i.loli.net/2020/02/19/ecaJjBtpHIEQoxC.gif"><meta property="article:published_time" content="2020-02-14T12:15:56.000Z"><meta property="article:modified_time" content="2020-04-03T15:18:02.569Z"><meta property="article:author" content="ä½™è…¾é–"><meta property="article:tag" content="react"><meta property="article:tag" content="typescript"><meta property="article:tag" content="webpack"><meta property="article:tag" content="express"><meta property="article:tag" content="babel"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://i.loli.net/2020/02/16/QS1lFJt7fbIYEcG.png"><link rel="canonical" href="https://lyreal666.com/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E9%85%8D%E7%BD%AE-react-typescript%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9Awebpack/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>ä»é›¶å¼€å§‹é…ç½® react + typescriptï¼ˆä¸‰ï¼‰ï¼šwebpack | ä½™è…¾é–çš„åšå®¢</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="ä½™è…¾é–çš„åšå®¢" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">ä½™è…¾é–çš„åšå®¢</span> <span class="logo-line-after"><i></i></span></a></div></div><div class="site-nav-toggle"><div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ "><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>å½’æ¡£</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>åˆ†ç±»</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>å…³äº</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-fw fa-link"></i>å‹é“¾</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="æœç´¢..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://lyreal666.com/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E9%85%8D%E7%BD%AE-react-typescript%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9Awebpack/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="ä½™è…¾é–"><meta itemprop="description" content="æ€»ç»“å’Œåˆ†äº«æˆ‘çš„æ‰€å­¦æ‰€æ€"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ä½™è…¾é–çš„åšå®¢"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">ä»é›¶å¼€å§‹é…ç½® react + typescriptï¼ˆä¸‰ï¼‰ï¼šwebpack</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºæ—¶é—´ï¼š2020-02-14 20:15:56" itemprop="dateCreated datePublished" datetime="2020-02-14T20:15:56+08:00">2020-02-14</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">æ›´æ–°äº</span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-04-03 23:18:02" itemprop="dateModified" datetime="2020-04-03T23:18:02+08:00">2020-04-03</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">åˆ†ç±»äº</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">å‰ç«¯</span> </a></span></span><span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span> <span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><p>æœ¬ç¯‡ä¸º <code>ä»é›¶å¼€å§‹é…ç½® react + typescript</code> ç³»åˆ—ç¬¬ä¸‰ç¯‡ï¼Œå°†å¸¦å¤§å®¶å®Œæˆæ¨¡æ¿é¡¹ç›®çš„ webpack é…ç½®ã€‚æ•´ä¸ªé¡¹ç›®çš„é…ç½®æˆ‘åŠ›æ±‚è¾¾åˆ°ä»¥ä¸‹ç›®æ ‡ï¼š</p><p><strong>çµæ´»ï¼š</strong> æˆ‘åœ¨é…ç½® eslint æ˜¯é€‰æ‹©ä½¿ç”¨ js æ ¼å¼è€Œä¸æ˜¯ jsonï¼Œå°±æ˜¯ä¸ºäº†çµæ´»æ€§ï¼Œä½¿ç”¨ js æ–‡ä»¶å¯ä»¥è®©ä½ ä½¿ç”¨å¯¼å…¥å…¶å®ƒæ¨¡å—ï¼Œæ ¹æ®å¼€å‘ç¯å¢ƒåŠ¨æ€é…ç½®ï¼Œå……åˆ†å‘æŒ¥ js è¯­è¨€çš„èƒ½åŠ›ã€‚</p><p><strong>æ–°æ½®ï¼š</strong> æˆ‘è§‰å¾—æ—¶åˆ»ä¿æŒå¯¹æ–°äº‹ç‰©çš„å…³æ³¨å’Œå°è¯•å»ä½¿ç”¨å®ƒæ˜¯ä¸€ä¸ªä¼˜ç§€çš„ç´ è´¨ã€‚å½“ç„¶ï¼Œè¿½æ–°å¾ˆå®¹æ˜“ç¢°åˆ°å‘ï¼Œä½†æ˜¯ï¼Œæ²¡å…³ç³»ï¼Œæˆ‘å·²ç»å¸®ä½ ä»¬è¸©è¿‡äº†ï¼Œè¸©ä¸è¿‡å»æˆ‘ä¹Ÿä¸ä¼šå†™å‡ºæ¥ ğŸ˜‚ã€‚ä»æˆ‘ eslint <code>parserOptions.ecmaVersion</code> è®¾ç½®ä¸º 2020ï¼Œ è¿˜æœ‰ç»å¸¸æ¥ä¸€å‘ <code>yarn upgrade --latest</code> éƒ½å¯ä»¥ä½“ç°å‡ºæ¥ã€‚</p><p><strong>ä¸¥æ ¼ï¼š</strong> å°±åƒæˆ‘å¹³æ—¶åˆ¤æ–­ç›¸ç­‰æ€§æˆ‘å¤§å¤šæ•°æƒ…å†µéƒ½æ˜¯ä½¿ç”¨ä¸¥æ ¼ç­‰ <code>===</code>ï¼Œè€Œä¸æ˜¯éä¸¥æ ¼ç­‰ <code>==</code>ï¼Œæˆ‘è§‰å¾—è¶Šä¸¥æ ¼ï¼Œåˆ†æèµ·æ¥å°±è¶Šæ¸…æ™°ï¼Œè¶Šæ—©èƒ½å‘ç°é—®é¢˜ã€‚ä¾‹å¦‚æˆ‘ä¹ˆåé¢ä¼šä½¿ç”¨ä¸€äº› webpack æ’ä»¶æ¥ä¸¥æ ¼æ£€æŸ¥æ¨¡å—å¤§å°å†™ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å¾ªç¯ä¾èµ–ã€‚</p><p><strong>å®‰é€¸ï¼š</strong> é¡¹ç›®ä¸­ä¼šå°½é‡é›†æˆå½“å‰å‰ç«¯ç”Ÿæ€ç•Œå®ç”¨çš„å’Œèƒ½æé«˜å¼€å‘æ„‰æ‚¦æ€§çš„ï¼ˆæ¢ä¸ªè¯å°±æ˜¯èŠ±é‡Œèƒ¡å“¨ï¼‰å·¥å…·ã€‚</p><p><strong>ç”Ÿäº§ ready</strong>ï¼šé…ç½®çš„æ—¶å€™é’ˆå¯¹ä¸åŒçš„æ‰“åŒ…ç¯å¢ƒé’ˆå¯¹æ€§ä¼˜åŒ–ï¼Œå¹¶ç¡®ä¿èƒ½å¤ŸæŠ•å…¥ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚</p><p>æœ¬ç¯‡å°†åˆ†ä¸‰å¤§éƒ¨åˆ†ä»‹ç»ï¼š</p><ol><li>dev server</li><li>å¼€å‘ç¯å¢ƒä¼˜åŒ–</li><li>ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–</li></ol><p>å¦‚æœè¯»è€…æ˜¯åˆæ¬¡çœ‹åˆ°è¿™ç¯‡æ–‡ç« ï¼Œå»ºè®®å…ˆçœ‹ä¸‹å‰ä¸¤ç¯‡ï¼š</p><ol><li><a href="https://lyreal666.com/ä»é›¶å¼€å§‹é…ç½®-react-typescriptï¼ˆä¸€ï¼‰ï¼šdotfiles/">ä»é›¶å¼€å§‹é…ç½® react + typescriptï¼ˆä¸€ï¼‰ï¼šdotfiles</a></li><li><a href="https://lyreal666.com/ä»é›¶å¼€å§‹é…ç½®-react-typescriptï¼ˆäºŒï¼‰ï¼šlinters-å’Œ-formatter/">ä»é›¶å¼€å§‹é…ç½® react + typescriptï¼ˆäºŒï¼‰ï¼šlinters å’Œ formatter</a></li></ol><p>é¡¹ç›®åœ°å€ï¼š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RqeDY2Ni9yZWFjdC10eXBlc2NyaXB0LWJvaWxlcnBsYXRl" title="https://github.com/tjx666/react-typescript-boilerplate">react-typescript-boilerplate<i class="fa fa-external-link"></i></span></p><a id="more"></a><h2 id="dev-server"><a href="#dev-server" class="headerlink" title="dev server"></a>dev server</h2><p>æƒ³å½“åˆæˆ‘åˆšå¼€å§‹å­¦å‰ç«¯æ¡†æ¶çš„é‚£æ—¶å€™ï¼Œä¹Ÿæ˜¯è¢« webpack æŠ˜ç£¨çš„æ¬²ä»™æ¬²æ­»ï¼Œæˆ‘æ˜¯å…ˆè‡ªå­¦çš„ node æ‰å¼€å§‹å†™å‰ç«¯ï¼Œå†™ nodejs å¾ˆæ–¹ä¾¿ï¼Œè‡ªå¸¦çš„æ¨¡å—åŒ–æ–¹æ¡ˆ <code>commonjs</code>ï¼Œå†™å‰ç«¯é¡¹ç›®å°±è¦é…ç½®æ‰“åŒ…å·¥å…·ã€‚å½“æ—¶æœ€ç«çš„æ‰“åŒ…å·¥å…·å·²ç»æ˜¯ webpack äº†ï¼Œå…¶æ¬¡å°±æ˜¯ <code>gulp</code>ã€‚é…ç½® webpack æ€»æ˜¯è®°ä¸ä½ webpack é…ç½®æœ‰å“ªäº›å­—æ®µï¼Œè¿˜è¦æ‰¯åˆ°ä¸€å †ç›¸å…³çš„å·¥å…·åƒ ES6 ç¼–è¯‘å™¨ <code>babel</code>ï¼ŒCSS é¢„å¤„ç†å™¨ <code>sass</code>/<code>less</code>ï¼ŒCSS åå¤„ç†å™¨ <code>postcss</code>ï¼Œä»¥åŠå„ç§ webpack çš„ loader å’Œ pluginã€‚ç„¶åå«Œéº»çƒ¦å°±æœ‰ä¸€æ®µæ—¶é—´éƒ½æ˜¯ç”¨å®˜æ–¹çš„è„šæ‰‹æ¶ï¼Œreact å°±ç”¨ <code>cra</code>ï¼Œä¹Ÿå°±æ˜¯ <code>create-react-app</code>ï¼Œvue å°±ç”¨ <code>vue-cli</code>ã€‚å…¶å®ä¹ŸæŒºå¥½ç”¨çš„ï¼Œä¸è¿‡è¯´å®è¯ï¼Œæˆ‘ä¸ªäººè§‰å¾—ï¼Œ<code>cra</code> æ²¡ <code>vue-cli</code> è®¾è®¡çš„å¥½ï¼Œæ— è®ºæ˜¯æ˜“ç”¨æ€§å’Œæ‰©å±•æ€§éƒ½å®Œè´¥ï¼Œcra ä¸æ–¹ä¾¿ç”¨æˆ·ä¿®æ”¹ webpack é…ç½®ï¼Œvue-cli ä¸ä½†æ˜“äºç”¨æˆ·ä¿®æ”¹ webpack é…ç½®ï¼Œè¿˜èƒ½è®©ç”¨æˆ·ä¿å­˜æ¨¡æ¿ä»¥åŠè‡ªå¸¦æ’ä»¶ç³»ç»Ÿã€‚æˆ‘æ„Ÿè§‰ react å®˜æ–¹ä¹Ÿæ„è¯†åˆ°äº†è¿™ç‚¹ï¼Œæ‰€ä»¥å®˜æ–¹å£°ç§°è¿‘æœŸå°†ä¼šé‡ç‚¹ä¼˜åŒ–ç›¸å…³å·¥å…·é“¾ã€‚ç°åœ¨çš„è¯ï¼Œå¦‚æœæˆ‘æ–°å»ºä¸€ä¸ªå‰ç«¯é¡¹ç›®ï¼Œæˆ‘ä¼šé€‰æ‹©è‡ªå·±é…ï¼Œä¸ä¼šå»é‡‡ç”¨å®˜æ–¹çš„ cliï¼Œå› ä¸ºæˆ‘è§‰å¾—æˆ‘è‡ªå·±å·²ç»ç›¸å½“ç†Ÿæ‚‰å‰ç«¯å„ç§æ„å»ºå·¥å…·äº†ï¼Œç­‰æˆ‘ä¸ŠåŠå¹´å¿™å®Œæ¯•ä¸šå’Œæ‰¾å·¥ä½œçš„äº‹æƒ…æˆ‘åº”è¯¥ä¼šå°†ä¸€äº›å¸¸ç”¨çš„é…ç½®æŠ½æˆä¸€ä¸ª npm åŒ…ï¼Œç°åœ¨æ¯æ¬¡å†™ä¸€ä¸ªé¡¹ç›®éƒ½ copy æ”¹å¤ªç´¯äº†ï¼Œä¸€ä¸ªé¡¹ç›®çš„æ„å»ºé…ç½®æœ‰ä¼˜åŒ–ç‚¹ï¼Œå…¶å®ƒé¡¹ç›®éƒ½è¦æ‰‹åŠ¨åŒæ­¥ä¸€ä¸‹ï¼Œæ•ˆç‡å¤ªä½ã€‚</p><h3 id="æŠ€æœ¯é€‰å‹"><a href="#æŠ€æœ¯é€‰å‹" class="headerlink" title="æŠ€æœ¯é€‰å‹"></a>æŠ€æœ¯é€‰å‹</h3><p>TypeScript ä½œä¸ºé™æ€ç±»å‹è¯­è¨€ï¼Œç›¸å¯¹äº js è€Œè¨€ï¼Œåœ¨ç±»å‹æç¤ºä¸Šå¸¦æ¥çš„æå‡æ— ç–‘æ˜¯å·¨å¤§çš„ã€‚å€ŸåŠ© IDE çš„ç±»å‹æç¤ºå’Œä»£ç è¡¥å…¨ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ webpack é…ç½®å¯¹è±¡æœ‰å“ªäº›å­—æ®µå°±ä¸ç”¨å»æŸ¥å®˜æ–¹æ–‡æ¡£äº†ï¼Œè€Œä¸”è¿˜ä¸ä¼šæ•²é”™ï¼Œå¾ˆå®‰é€¸ï¼Œæ‰€ä»¥å¼€å‘è¯­è¨€å°±é€‰æ‹© <strong>TypeScript</strong>ã€‚</p><p>å®˜æ–¹æ–‡æ¡£ä¸Šæœ‰ä¸“é—¨ä¸€èŠ‚ <span class="exturl" data-url="aHR0cHM6Ly93ZWJwYWNrLmpzLm9yZy9jb25maWd1cmF0aW9uL2NvbmZpZ3VyYXRpb24tbGFuZ3VhZ2VzLw==" title="https://webpack.js.org/configuration/configuration-languages/">Configuration Languages<i class="fa fa-external-link"></i></span> ä»‹ç» webpack å‘½ä»¤è¡Œå·¥å…·æ€ä¹ˆä½¿ç”¨ ts æ ¼å¼çš„é…ç½®æ–‡ä»¶ ï¼Œæˆ‘è§‰å¾— <code>webpack-dev-server</code> å‘½ä»¤è¡Œå·¥å…·åº”è¯¥æ˜¯ä¸€æ ·çš„ã€‚</p><p>ä½†æ˜¯æˆ‘ä¸æ‰“ç®—ä½¿ç”¨å®˜æ–¹æ–‡æ¡£ä»‹ç»çš„æ–¹å¼ï¼Œæˆ‘å‹æ ¹ä¸æ‰“ç®—ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨ node API æ‰æ˜¯<strong>æœ€çµæ´»</strong>çš„é…ç½®æ–¹å¼ã€‚é…ç½® <code>webpack devServer</code> æ€»ç»“ä¸€ä¸‹æœ‰ä»¥ä¸‹æ–¹å¼ï¼š</p><ol><li><code>webpack-dev-server</code>ï¼Œè¿™æ˜¯æœ€ä¸çµæ´»çš„æ–¹å¼ï¼Œå½“ç„¶ä½¿ç”¨åœºæ™¯ç®€å•çš„æƒ…å†µä¸‹è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„</li><li><code>webpack-dev-server</code> node APIï¼Œåœ¨ node è„šæœ¬é‡Œé¢è°ƒç”¨ <code>web-dev-server</code> åŒ…æä¾›çš„ node API æ¥å¯åŠ¨ devServer</li><li><code>express</code> + <code>webpack devServer ç›¸å…³ä¸­é—´ä»¶</code>ï¼Œå®é™…ä¸Š <code>webpack-dev-server</code> å°±æ˜¯ä½¿ç”¨ <code>express</code> ä»¥åŠä¸€äº› devServer ç›¸å…³çš„ä¸­é—´ä»¶å¼€å‘çš„ã€‚åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œ å„ç§ä¸­é—´ä»¶ç›´æ¥æš´éœ²å‡ºæ¥äº†ï¼Œæˆ‘ä»¬å¯ä»¥çµæ´»é…ç½®å„ä¸ªä¸­é—´ä»¶çš„é€‰é¡¹ã€‚</li><li><code>koa</code> + <code>webpack devServer ç›¸å…³ä¸­é—´ä»¶</code>ï¼Œæˆ‘åœ¨ github ä¸Šè¿˜çœŸçš„æœåˆ°äº†å’Œ webpack devServer ç›¸å…³çš„ webpack ä¸­é—´ä»¶ã€‚å…¶å® webpack devServer å°±æ˜¯ä¸€ä¸ª node server å˜›ï¼Œç”¨ä»€ä¹ˆæ¡†æ¶æŠ€æœ¯å®ç°ä¸é‡è¦ï¼Œèƒ½å®ç°æˆ‘ä»¬éœ€è¦çš„åŠŸèƒ½å°±è¡Œã€‚</li></ol><p>æˆ‘æœ€ç»ˆé‡‡ç”¨ <code>express</code> + <code>webpack devServer ç›¸å…³ä¸­é—´ä»¶</code>çš„æ–¹å¼ï¼Œä¸ºä»€ä¹ˆä¸é€‰æ‹©ç”¨ <code>koa</code> ï¼Ÿå› ä¸ºæˆ‘è§‰å¾—å®˜æ–¹ç”¨çš„å°±æ˜¯ <code>express</code>ï¼Œç”¨ <code>express</code> è‚¯å®šè¦æ¯” <code>koa</code> æ›´æˆç†Ÿç¨³å®šï¼Œå‘è¦å°‘ä¸€äº›ã€‚</p><h3 id="å®ç°æœ€åŸºæœ¬çš„æ‰“åŒ…åŠŸèƒ½"><a href="#å®ç°æœ€åŸºæœ¬çš„æ‰“åŒ…åŠŸèƒ½" class="headerlink" title="å®ç°æœ€åŸºæœ¬çš„æ‰“åŒ…åŠŸèƒ½"></a>å®ç°æœ€åŸºæœ¬çš„æ‰“åŒ…åŠŸèƒ½</h3><p>ä»ç®€åˆ°ç¹ï¼Œæˆ‘ä»¬å…ˆæ¥å®ç°æœ€åŸºæœ¬çš„æ‰“åŒ…åŠŸèƒ½ä½¿å…¶èƒ½å¤Ÿæ‰“åŒ… <code>tsx</code> æ–‡ä»¶ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šä¸€æ­¥ä¸€æ­¥ä¸°å¯Œï¼Œä¼˜åŒ–æˆ‘ä»¬çš„é…ç½®ã€‚</p><h4 id="é…ç½®å…¥å£æ–‡ä»¶"><a href="#é…ç½®å…¥å£æ–‡ä»¶" class="headerlink" title="é…ç½®å…¥å£æ–‡ä»¶"></a>é…ç½®å…¥å£æ–‡ä»¶</h4><p>å…ˆå®‰è£… TypeScriptï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœ¬åœ°å®‰è£…å¼€å‘ä¾èµ– typescript</span></span><br><span class="line">yarn add typescript -D</span><br></pre></td></tr></table></figure><p>æ¯ä¸ª TypeScript é¡¹ç›®éƒ½éœ€è¦æœ‰ä¸€ä¸ª <code>tsconfig.json</code> é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤åœ¨ <code>src</code> ç›®å½•ä¸‹æ–°å»º <code>tsconfig.json</code> æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> src &amp;&amp; npx tsc --init &amp;&amp; <span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æš‚æ—¶è°ƒæ•´æˆè¿™æ ·ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"compilerOptions"</span>: &#123;</span><br><span class="line">        <span class="comment">/* Basic Options */</span></span><br><span class="line">        <span class="string">"jsx"</span>: <span class="string">"react"</span>,</span><br><span class="line">        <span class="string">"isolatedModules"</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Strict Type-Checking Options */</span></span><br><span class="line">        <span class="string">"strict"</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Additional Checks */</span></span><br><span class="line">        <span class="string">"noUnusedLocals"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"noUnusedParameters"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"noImplicitReturns"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"noFallthroughCasesInSwitch"</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Module Resolution Options */</span></span><br><span class="line">        <span class="string">"moduleResolution"</span>: <span class="string">"node"</span>,</span><br><span class="line">        <span class="string">"esModuleInterop"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"resolveJsonModule"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"baseUrl"</span>: <span class="string">"./"</span>,</span><br><span class="line">        <span class="string">"paths"</span>: &#123;</span><br><span class="line">            <span class="comment">// é…ç½®æ¨¡å—è·¯å¾„æ˜ å°„</span></span><br><span class="line">            <span class="string">"@/*"</span>: [<span class="string">"./*"</span>],</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Experimental Options */</span></span><br><span class="line">        <span class="string">"experimentalDecorators"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"emitDecoratorMetadata"</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Advanced Options */</span></span><br><span class="line">        <span class="string">"forceConsistentCasingInFileNames"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"skipLibCheck"</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸‹é¢è¿™äº›é€‰é¡¹å¯¹ babel ç¼–è¯‘ TypeScript æ²¡æœ‰ä½œç”¨ä½†æ˜¯å¯ä»¥è®© VSCode ç­‰ç¼–è¾‘å™¨æ­£ç¡®æç¤ºé”™è¯¯</span></span><br><span class="line">        <span class="string">"target"</span>: <span class="string">"ES2019"</span>,</span><br><span class="line">        <span class="string">"module"</span>: <span class="string">"ESNext"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†ä½¿ç”¨ babel å»ç¼–è¯‘ TypeScriptï¼Œbabel åœ¨ç¼–è¯‘ TypeScript ä»£ç æ˜¯ç›´æ¥å»æ‰ TypeScript çš„ç±»å‹ï¼Œç„¶åå½“æˆæ™®é€šçš„ javascript ä»£ç ä½¿ç”¨å„ç§æ’ä»¶è¿›è¡Œç¼–è¯‘ï¼Œtsc å¹¶æ²¡æœ‰ä»‹å…¥ç¼–è¯‘è¿‡ç¨‹ï¼Œå› æ­¤ <code>tsconfig.json</code> ä¸­å¾ˆå¤šé€‰é¡¹ä¾‹å¦‚ <code>target</code> å’Œ <code>module</code> æ˜¯æ²¡æœ‰ç”¨çš„ã€‚</p><p>å¯ç”¨ <code>isolatedModules</code> é€‰é¡¹ä¼šåœ¨ babel ç¼–è¯‘ä»£ç æ—¶æä¾›ä¸€äº›é¢å¤–çš„æ£€æŸ¥ï¼Œ<code>esModuleInterop</code> è¿™ä¸ªé€‰é¡¹æ˜¯ç”¨æ¥ä¸ºäº†è®©æ²¡æœ‰ default å±æ€§çš„æ¨¡å—ä¹Ÿå¯ä»¥ä½¿ç”¨é»˜è®¤å¯¼å…¥ï¼Œä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå¦‚æœè¿™ä¸ªé€‰é¡¹æ²¡å¼€å¯ï¼Œé‚£ä½ å¯¼å…¥ fs æ¨¡å—åªèƒ½åƒä¸‹é¢è¿™æ ·å¯¼å…¥ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> fs <span class="keyword">from</span> <span class="string">'fs'</span>;</span><br></pre></td></tr></table></figure><p>å¼€å¯äº†ä»¥åï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨é»˜è®¤å¯¼å…¥ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">'fs'</span>;</span><br></pre></td></tr></table></figure><p>æœ¬è´¨ä¸Š ESM é»˜è®¤å¯¼å…¥æ˜¯å¯¼å…¥æ¨¡å—çš„ default å±æ€§ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">'fs'</span>;</span><br><span class="line"><span class="comment">// ç­‰åŒäº</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> __module__ <span class="keyword">from</span> <span class="string">'fs'</span>;</span><br><span class="line"><span class="keyword">let</span> fs = __module__.default;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ node å†…å»ºæ¨¡å— fs æ˜¯æ²¡æœ‰ default å±æ€§çš„ï¼Œå¼€å¯ <code>isolatedModules</code> é€‰é¡¹å°±ä¼šåœ¨æ²¡æœ‰ default å±æ€§çš„æƒ…å†µä¸‹è‡ªåŠ¨è½¬æ¢ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> fs, &#123; resolve &#125; <span class="keyword">from</span> <span class="string">'fs'</span>;</span><br><span class="line"><span class="comment">// è½¬æ¢æˆ</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> fs <span class="keyword">from</span> <span class="string">'fs'</span>;</span><br><span class="line"><span class="keyword">let</span> &#123; resolve &#125; = fs;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå…¥å£æ–‡ä»¶ <code>src/index.tsx</code>ï¼Œå†…å®¹å¾ˆç®€å•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> plus <span class="keyword">from</span> <span class="string">'./plus'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(plus(<span class="number">404</span>, <span class="number">404</span>, <span class="number">404</span>, <span class="number">404</span>, <span class="number">404</span>)); <span class="comment">// =&gt; 2020</span></span><br></pre></td></tr></table></figure><p><code>src/plus.ts</code> å†…å®¹ä¸ºï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">plus</span>(<span class="params">...nums: number[]</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> nums.reduce(<span class="function">(<span class="params">pre, current</span>) =&gt;</span> pre + current, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¼–è¯‘-TypeScript"><a href="#ç¼–è¯‘-TypeScript" class="headerlink" title="ç¼–è¯‘ TypeScript"></a>ç¼–è¯‘ TypeScript</h4><p>æˆ‘ä»¬çŸ¥é“ webpack é»˜è®¤çš„æ¨¡å—åŒ–ç³»ç»Ÿåªæ”¯æŒ js æ–‡ä»¶ï¼Œå¯¹äºå…¶å®ƒç±»å‹çš„æ–‡ä»¶å¦‚ jsx, ts, tsx, vue ä»¥åŠå›¾ç‰‡å­—ä½“ç­‰æ–‡ä»¶ç±»å‹ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…å¯¹åº”çš„ loaderã€‚å¯¹äº ts æ–‡ä»¶ï¼Œç›®å‰å­˜åœ¨æ¯”è¾ƒæµè¡Œçš„æ–¹æ¡ˆæœ‰ä¸‰ç§:</p><ol><li><p>babel + <span class="exturl" data-url="aHR0cHM6Ly9iYWJlbGpzLmlvL2RvY3MvZW4vYmFiZWwtcHJlc2V0LXR5cGVzY3JpcHQ=" title="https://babeljs.io/docs/en/babel-preset-typescript">@babel/preset-typescript<i class="fa fa-external-link"></i></span></p></li><li><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1R5cGVTdHJvbmcvdHMtbG9hZGVy" title="https://github.com/TypeStrong/ts-loader">ts-loader<i class="fa fa-external-link"></i></span></p></li><li><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3MtcGFuZmVyb3YvYXdlc29tZS10eXBlc2NyaXB0LWxvYWRlcg==" title="https://github.com/s-panferov/awesome-typescript-loader">awesome-typescript-loader<i class="fa fa-external-link"></i></span></p></li></ol><p>awesome-typescript-loader å°±ç®—äº†ï¼Œä½œè€…å·²ç»æ”¾å¼ƒç»´æŠ¤äº†ã€‚é¦–å…ˆ babel æˆ‘ä»¬ä¸€å®šè¦ç”¨çš„ï¼Œå› ä¸º babel ç”Ÿæ€æœ‰å¾ˆå¤šå®ç”¨çš„æ’ä»¶ã€‚è™½ç„¶ babel æ˜¯å¯ä»¥å’Œ ts-loader ä¸€èµ·ç”¨ï¼Œts-loader å®˜æ–¹ç»™äº†ä¸€ä¸ªä¾‹å­ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1R5cGVTdHJvbmcvdHMtbG9hZGVyL3RyZWUvbWFzdGVyL2V4YW1wbGVzL3JlYWN0LWJhYmVsLWthcm1hLWd1bHA=" title="https://github.com/TypeStrong/ts-loader/tree/master/examples/react-babel-karma-gulp">react-babel-karma-gulp<i class="fa fa-external-link"></i></span>ï¼Œä½†æ˜¯æˆ‘è§‰å¾—æ—¢ç„¶ babel å·²ç»èƒ½å¤Ÿç¼–è¯‘ TypeScript æˆ‘ä»¬å°±æ²¡å¿…è¦å†åŠ ä¸€ä¸ª ts-loaderï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©æ–¹æ¡ˆä¸€ã€‚éœ€è¦æŒ‡å‡ºçš„ä¸€ç‚¹å°±æ˜¯å°±æ˜¯ babel é»˜è®¤ä¸ä¼šæ£€æŸ¥ TypeScript çš„ç±»å‹ï¼Œåé¢ webpack æ’ä»¶éƒ¨åˆ†æˆ‘ä»¬ä¼šé€šè¿‡é…ç½® <code>fork-ts-checker-webpack-plugin</code> æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h4 id="æ·»åŠ -webpack-é…ç½®"><a href="#æ·»åŠ -webpack-é…ç½®" class="headerlink" title="æ·»åŠ  webpack é…ç½®"></a>æ·»åŠ  webpack é…ç½®</h4><p>æˆ‘ä»¬å°†æŠŠæ‰€æœ‰ node è„šæœ¬æ”¾åˆ°é¡¹ç›®æ ¹ç›®çš„ <code>scripts</code> æ–‡ä»¶å¤¹ï¼Œå› ä¸º <code>src</code> æ–‡ä»¶å¤¹æ˜¯å‰ç«¯é¡¹ç›®ï¼Œè€Œ <code>scripts</code> æ–‡ä»¶å¤¹æ˜¯ node é¡¹ç›®ï¼Œæˆ‘ä»¬åº”è¯¥åˆ†åˆ«é…ç½® <code>tsconfig.json</code>ï¼Œé€šè¿‡ä¸‹é¢çš„å‘½ä»¤åœ¨å…¶ä¸­ç”Ÿæˆåˆå§‹çš„ <code>tsconfig.json</code> æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ./scripts &amp;&amp; npx tsc --init &amp;&amp; <span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è°ƒæ•´æˆé…±ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// scripts/tsconfig.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"compilerOptions"</span>: &#123;</span><br><span class="line">        <span class="comment">/* Basic Options */</span></span><br><span class="line">        <span class="string">"target"</span>: <span class="string">"ES2019"</span>,</span><br><span class="line">        <span class="string">"module"</span>: <span class="string">"commonjs"</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Strict Type-Checking Options */</span></span><br><span class="line">        <span class="string">"strict"</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Additional Checks */</span></span><br><span class="line">        <span class="string">"noUnusedLocals"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"noUnusedParameters"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"noImplicitReturns"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"noFallthroughCasesInSwitch"</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Module Resolution Options */</span></span><br><span class="line">        <span class="string">"moduleResolution"</span>: <span class="string">"node"</span>,</span><br><span class="line">        <span class="string">"esModuleInterop"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"resolveJsonModule"</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Experimental Options */</span></span><br><span class="line">        <span class="string">"experimentalDecorators"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"emitDecoratorMetadata"</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Advanced Options */</span></span><br><span class="line">        <span class="string">"forceConsistentCasingInFileNames"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"skipLibCheck"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æå‡ ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼š</p><ul><li><p><code>&quot;target&quot;: &quot;ES2019&quot;</code>ï¼Œå…¶å®ç¼–è¯‘çº§åˆ«ä½ è°ƒçš„å¾ˆä½æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½ ç”¨é«˜çº§è¯­æ³• tsc å°±è½¬ç å‘—ï¼Œç¼ºç‚¹å°±æ˜¯è½¬ç åä»£ç ä½“ç§¯ä¸€èˆ¬ä¼šå˜å¤§ï¼Œæ‰§è¡Œæ•ˆç‡ä¹Ÿä¼šé™ä½ï¼ŒåŸç”Ÿè¯­æ³•ä¸€èˆ¬éƒ½æ˜¯è¢«ä¼˜åŒ–è¿‡çš„ã€‚æˆ‘å–œæ¬¢è°ƒé«˜ä¸€ç‚¹ï¼Œä¸€èˆ¬æ¥è¯´åªè¦ä¸ç”¨é‚£äº›åœ¨ä»£ç è¿è¡Œå¹³å°è¿˜ä¸æ”¯æŒçš„è¯­æ³•å°±æ²¡é—®é¢˜ã€‚è‡ªä» TypeScript3.7 æ”¯æŒäº†å¯é€‰é“¾ï¼Œæˆ‘å°±å¼€å§‹å°è¯•åœ¨ TypeScript ä½¿ç”¨å®ƒï¼Œä½†æ˜¯é—®é¢˜æ¥äº†ï¼Œæˆ‘ä¹‹å‰ç¼–è¯‘çº§åˆ«ä¸€ç›´éƒ½æ˜¯è°ƒæˆæœ€é«˜ï¼Œä¹Ÿå°±æ˜¯ <code>ESNext</code>ï¼Œå› ä¸ºå¯é€‰é“¾åœ¨ <code>ES2020</code> å·²ç»æ˜¯æ ‡å‡†äº†ï¼Œæ‰€ä»¥ tsc å¯¹äºå¯é€‰é“¾ä¸ä¼šè½¬ç çš„ã€‚ç„¶å node 12 è¿˜ä¸æ”¯æŒå¯é€‰é“¾ï¼Œå°±ä¼šæŠ¥è¯­æ³•é”™è¯¯ï¼Œäºæ˜¯æˆ‘å°±é™åˆ° <code>ES2019</code> äº†ã€‚</p></li><li><p><code>Strict Type-Checking Options</code>ï¼Œè¿™éƒ¨åˆ†å…¨å¼€ï¼Œæ—¢ç„¶ä¸Šäº† TypeScript çš„èˆ¹ï¼Œå°±ç”¨æœ€ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥ï¼Œæ‹’ç» AnyScript</p></li></ul><p>æ¥ç€æˆ‘ä»¬æ–°å»º <code>scripts/configs</code>æ–‡ä»¶å¤¹ï¼Œé‡Œé¢ç”¨æ¥å­˜æ”¾åŒ…æ‹¬ webpack çš„é…ç½®æ–‡ä»¶ã€‚åœ¨å…¶ä¸­æ–°å»ºä¸‰ä¸ª webpack çš„é…ç½®æ–‡ä»¶ <code>webpack.common.ts</code>ï¼Œ <code>webpack.dev.ts</code>å’Œ <code>webapck.prod.ts</code>ã€‚<code>webpack.common.ts</code> ä¿å­˜ä¸€äº›å…¬å…±çš„é…ç½®æ–‡ä»¶ï¼Œ<code>webpack.dev.ts</code> æ˜¯å¼€å‘ç¯å¢ƒç”¨çš„ï¼Œä¼šè¢« devServer è¯»å–ï¼Œ<code>webapck.prod.ts</code> æ˜¯æˆ‘ä»¬åœ¨æ„å»ºç”Ÿäº§ç¯å¢ƒçš„ bundle æ—¶ç”¨çš„ã€‚</p><p>æˆ‘ä»¬æ¥ç€å®‰è£… webpack å’Œ webpack-merge ä»¥åŠå®ƒä»¬çš„ç±»å‹å£°æ˜æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add webpack webpack-merge @types/webpack @types/webpack-merge -D</span><br></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N1cnZpdmVqcy93ZWJwYWNrLW1lcmdl" title="https://github.com/survivejs/webpack-merge">webpack-merge<i class="fa fa-external-link"></i></span> æ˜¯ä¸€ä¸ªä¸º merge webpack é…ç½®è®¾è®¡çš„ merge å·¥å…·ï¼Œæä¾›äº†ä¸€äº›é«˜çº§çš„ merge æ–¹å¼ã€‚ä¸è¿‡æˆ‘ç›®å‰å¹¶æ²¡æœ‰ç”¨åˆ°é‚£äº›é«˜çº§çš„ merge æ–¹å¼ï¼Œå°±æ˜¯å½“æˆæ™®é€šçš„ merge å·¥å…·ä½¿ç”¨ï¼Œåç»­å¯ä»¥æ¢ç´¢ä¸€ä¸‹è¿™æ–¹é¢çš„ä¼˜åŒ–ã€‚</p><p>ä¸ºäº†ç¼–è¯‘ tsxï¼Œæˆ‘ä»¬éœ€è¦å®‰è£… <code>babel-loader</code> å’Œç›¸å…³æ’ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add babel-loader @babel/core @babel/preset-typescript -D</span><br></pre></td></tr></table></figure><p>æ–°å»º babel é…ç½®æ–‡ä»¶ <code>babel.config.js</code>ï¼Œç°åœ¨æˆ‘ä»¬åªæ·»åŠ ä¸€ä¸ª TypeScript presetï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// babel.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">api</span>) </span>&#123;</span><br><span class="line">  api.cache(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> presets = [<span class="string">'@babel/preset-typescript'</span>];</span><br><span class="line">  <span class="keyword">const</span> plugins = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    presets,</span><br><span class="line">    plugins,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ·»åŠ  babel-loader åˆ° <code>webpack.common.ts</code>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.common.ts`</span></span><br><span class="line"><span class="keyword">import</span> &#123; Configuration &#125; <span class="keyword">from</span> <span class="string">'webpack'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; projectName, projectRoot, resolvePath &#125; <span class="keyword">from</span> <span class="string">'../env'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> commonConfig: Configuration = &#123;</span><br><span class="line">  context: projectRoot,</span><br><span class="line">  entry: resolvePath(projectRoot, <span class="string">'./src/index.tsx'</span>),</span><br><span class="line">  output: &#123;</span><br><span class="line">    publicPath: <span class="string">'/'</span>,</span><br><span class="line">    path: resolvePath(projectRoot, <span class="string">'./dist'</span>),</span><br><span class="line">    filename: <span class="string">'js/[name]-[hash].bundle.js'</span>,</span><br><span class="line">    <span class="comment">// åŠ ç› hash</span></span><br><span class="line">    hashSalt: projectName || <span class="string">'react typescript boilerplate'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    <span class="comment">// æˆ‘ä»¬å¯¼å…¥ts ç­‰æ¨¡å—ä¸€èˆ¬ä¸å†™åç¼€åï¼Œwebpack ä¼šå°è¯•ä½¿ç”¨è¿™ä¸ªæ•°ç»„æä¾›çš„åç¼€åå»å¯¼å…¥</span></span><br><span class="line">    extensions: [<span class="string">'.ts'</span>, <span class="string">'.tsx'</span>, <span class="string">'.js'</span>, <span class="string">'.json'</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// å¯¼å…¥ jsx çš„äººå°‘å–ç‚¹</span></span><br><span class="line">        test: <span class="regexp">/\.(tsx?|js)$/</span>,</span><br><span class="line">        loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">        <span class="comment">// å¼€å¯ç¼“å­˜</span></span><br><span class="line">        options: &#123; <span class="attr">cacheDirectory</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æˆ‘è§‰å¾—è¿™ä¸ª react + ts é¡¹ç›®ä¸åº”è¯¥ä¼šå‡ºç° jsx æ–‡ä»¶ï¼Œå¦‚æœå¯¼å…¥äº† jsx æ–‡ä»¶ webpack å°±ä¼šæŠ¥é”™æ‰¾ä¸åˆ°å¯¹åº”çš„ loaderï¼Œå¯ä»¥è®©æˆ‘ä»¬åŠæ—¶å¤„ç†æ‰è¿™ä¸ªæœ‰é—®é¢˜çš„æ–‡ä»¶ã€‚</p><h4 id="ä½¿ç”¨-express-å¼€å‘-devServer"><a href="#ä½¿ç”¨-express-å¼€å‘-devServer" class="headerlink" title="ä½¿ç”¨ express å¼€å‘ devServer"></a>ä½¿ç”¨ express å¼€å‘ devServer</h4><p>æˆ‘ä»¬å…ˆå®‰è£… <code>express</code> ä»¥åŠå’Œ webpack devServer ç›¸å…³çš„ä¸€äº›ä¸­é—´ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add express webpack-dev-middleware webpack-hot-middleware @types/express @t</span><br><span class="line">ypes/webpack-dev-middleware @types/webpack-hot-middleware -D</span><br></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dlYnBhY2svd2VicGFjay1kZXYtbWlkZGxld2FyZQ==" title="https://github.com/webpack/webpack-dev-middleware">webpack-dev-middleware<i class="fa fa-external-link"></i></span> è¿™ä¸ª <code>express</code> ä¸­é—´ä»¶çš„ä¸»è¦ä½œç”¨ï¼š</p><ol><li>ä½œä¸ºä¸€ä¸ªé™æ€æ–‡ä»¶æœåŠ¡å™¨ï¼Œä½¿ç”¨å†…å­˜æ–‡ä»¶ç³»ç»Ÿæ‰˜ç®¡ webpack ç¼–è¯‘å‡ºçš„ bundle</li><li>å¦‚æœæ–‡ä»¶è¢«ä¿®æ”¹äº†ï¼Œä¼šå»¶è¿ŸæœåŠ¡å™¨çš„è¯·æ±‚ç›´åˆ°ç¼–è¯‘å®Œæˆ</li><li>é…åˆ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dlYnBhY2stY29udHJpYi93ZWJwYWNrLWhvdC1taWRkbGV3YXJl" title="https://github.com/webpack-contrib/webpack-hot-middleware">webpack-hot-middleware<i class="fa fa-external-link"></i></span> å®ç°çƒ­æ›´æ–°åŠŸèƒ½</li></ol><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dlYnBhY2stY29udHJpYi93ZWJwYWNrLWhvdC1taWRkbGV3YXJl" title="https://github.com/webpack-contrib/webpack-hot-middleware">webpack-hot-middleware<i class="fa fa-external-link"></i></span> è¿™ä¸ª express ä¸­é—´ä»¶ä¼šå°†è‡ªå·±æ³¨å†Œä¸ºä¸€ä¸ª webpack æ’ä»¶ï¼Œç›‘å¬ webpack çš„ç¼–è¯‘äº‹ä»¶ã€‚ ä½ å“ªä¸ª entry éœ€è¦å®ç°çƒ­æ›´æ–°ï¼Œå°±è¦åœ¨é‚£ä¸ª entry ä¸­å¯¼å…¥è¿™ä¸ªæ’ä»¶æä¾›çš„ <code>webpack-hot-middleware/client.js</code> å®¢æˆ·ç«¯è¡¥ä¸ã€‚è¿™ä¸ªå‰ç«¯ä»£ç ä¼šè·å– devServer çš„ <span class="exturl" data-url="aHR0cDovL3d3dy5odG1sNXJvY2tzLmNvbS9lbi90dXRvcmlhbHMvZXZlbnRzb3VyY2UvYmFzaWNzLw==" title="http://www.html5rocks.com/en/tutorials/eventsource/basics/">Server Sent Events<i class="fa fa-external-link"></i></span> è¿æ¥ï¼Œå½“æœ‰ç¼–è¯‘äº‹ä»¶å‘ç”Ÿï¼ŒdevServer ä¼šå‘å¸ƒé€šçŸ¥ç»™è¿™ä¸ªå®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯æ¥å—åˆ°é€šçŸ¥åï¼Œä¼šé€šè¿‡æ¯”å¯¹ hash å€¼åˆ¤æ–­æœ¬åœ°ä»£ç æ˜¯ä¸æ˜¯æœ€æ–°çš„ï¼Œå¦‚æœä¸æ˜¯å°±ä¼šå‘ devServer æ‹‰å–æ›´æ–°è¡¥ä¸å€ŸåŠ©ä¸€äº›å…¶å®ƒçš„å·¥å…·ä¾‹å¦‚ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dhZWFyb24vcmVhY3QtaG90LWxvYWRlcg==" title="https://github.com/gaearon/react-hot-loader">react-hot-loader<i class="fa fa-external-link"></i></span> å®ç°çƒ­æ›´æ–°ã€‚</p><p>ä¸‹é¢æ˜¯æˆ‘å¦å¤–ä¸€ä¸ªè¿˜åœ¨å¼€å‘çš„ electron é¡¹ç›®ä¿®æ”¹äº†ä¸€è¡Œä»£ç åï¼Œ client è¡¥ä¸å‘é€çš„ä¸¤æ¬¡è¯·æ±‚ï¼š</p><p><img data-src="https://i.loli.net/2020/02/16/QS1lFJt7fbIYEcG.png" alt="hash"></p><p><img data-src="https://i.loli.net/2020/02/16/PVpnHNC9G7rEtQT.png" alt="update"></p><p>ç¬¬ä¸€æ¬¡è¯·æ±‚è¿”å›çš„é‚£ä¸ª h å€¼åŠ¨åŠ¨è„šè¶¾å¤´å°±èƒ½çŒœå‡ºæ¥å°±æ˜¯ hash å€¼ï¼Œå‘ç°å’Œæœ¬åœ°çš„ hash å€¼æ¯”å¯¹ä¸ä¸Šåï¼Œå†æ¬¡è¯·æ±‚æ›´æ–°è¡¥ä¸ã€‚</p><p>æˆ‘ä»¬æ–°å»ºæ–‡ä»¶ <code>scripts/start.ts</code> ç”¨æ¥å¯åŠ¨æˆ‘ä»¬çš„ devServerï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> chalk <span class="keyword">from</span> <span class="string">'chalk'</span>;</span><br><span class="line"><span class="keyword">import</span> getPort <span class="keyword">from</span> <span class="string">'get-port'</span>;</span><br><span class="line"><span class="keyword">import</span> logSymbols <span class="keyword">from</span> <span class="string">'log-symbols'</span>;</span><br><span class="line"><span class="keyword">import</span> open <span class="keyword">from</span> <span class="string">'open'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; argv &#125; <span class="keyword">from</span> <span class="string">'yargs'</span>;</span><br><span class="line"><span class="keyword">import</span> express, &#123; Express &#125; <span class="keyword">from</span> <span class="string">'express'</span>;</span><br><span class="line"><span class="keyword">import</span> webpack, &#123; Compiler, Stats &#125; <span class="keyword">from</span> <span class="string">'webpack'</span>;</span><br><span class="line"><span class="keyword">import</span> historyFallback <span class="keyword">from</span> <span class="string">'connect-history-api-fallback'</span>;</span><br><span class="line"><span class="keyword">import</span> cors <span class="keyword">from</span> <span class="string">'cors'</span>;</span><br><span class="line"><span class="keyword">import</span> webpackDevMiddleware <span class="keyword">from</span> <span class="string">'webpack-dev-middleware'</span>;</span><br><span class="line"><span class="keyword">import</span> webpackHotMiddleware <span class="keyword">from</span> <span class="string">'webpack-hot-middleware'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> proxy <span class="keyword">from</span> <span class="string">'./proxy'</span>;</span><br><span class="line"><span class="keyword">import</span> devConfig <span class="keyword">from</span> <span class="string">'./configs/webpack.dev'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; hmrPath &#125; <span class="keyword">from</span> <span class="string">'./env'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">openBrowser</span>(<span class="params">compiler: Compiler, address: string</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (argv.open) &#123;</span><br><span class="line">        <span class="keyword">let</span> hadOpened = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// ç¼–è¯‘å®Œæˆæ—¶æ‰§è¡Œ</span></span><br><span class="line">        compiler.hooks.done.tap(<span class="string">'open-browser-plugin'</span>, <span class="keyword">async</span> (stats: Stats) =&gt; &#123;</span><br><span class="line">            <span class="comment">// æ²¡æœ‰æ‰“å¼€è¿‡æµè§ˆå™¨å¹¶ä¸”æ²¡æœ‰ç¼–è¯‘é”™è¯¯å°±æ‰“å¼€æµè§ˆå™¨</span></span><br><span class="line">            <span class="keyword">if</span> (!hadOpened &amp;&amp; !stats.hasErrors()) &#123;</span><br><span class="line">                <span class="keyword">await</span> open(address);</span><br><span class="line">                hadOpened = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setupMiddlewares</span>(<span class="params">compiler: Compiler, server: Express</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> publicPath = devConfig.output!.publicPath!;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®ä»£ç†</span></span><br><span class="line">    proxy(server);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ browserRouter éœ€è¦é‡å®šå‘æ‰€æœ‰ html é¡µé¢åˆ°é¦–é¡µ</span></span><br><span class="line">    server.use(historyFallback());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼€å‘ chrome æ‰©å±•çš„æ—¶å€™å¯èƒ½éœ€è¦å¼€å¯è·¨åŸŸï¼Œå‚è€ƒï¼šhttps://juejin.im/post/5e2027096fb9a02fe971f6b8</span></span><br><span class="line">    server.use(cors());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> devMiddlewareOptions: webpackDevMiddleware.Options = &#123;</span><br><span class="line">        <span class="comment">// ä¿æŒå’Œ webpack ä¸­é…ç½®ä¸€è‡´</span></span><br><span class="line">        publicPath,</span><br><span class="line">        <span class="comment">// åªåœ¨å‘ç”Ÿé”™è¯¯æˆ–æœ‰æ–°çš„ç¼–è¯‘æ—¶è¾“å‡º</span></span><br><span class="line">        stats: <span class="string">'minimal'</span>,</span><br><span class="line">        <span class="comment">// éœ€è¦è¾“å‡ºæ–‡ä»¶åˆ°ç£ç›˜å¯ä»¥å¼€å¯</span></span><br><span class="line">        <span class="comment">// writeToDisk: true</span></span><br><span class="line">    &#125;;</span><br><span class="line">    server.use(webpackDevMiddleware(compiler, devMiddlewareOptions));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> hotMiddlewareOptions: webpackHotMiddleware.Options = &#123;</span><br><span class="line">        <span class="comment">// sse è·¯ç”±</span></span><br><span class="line">        path: hmrPath,</span><br><span class="line">        <span class="comment">// ç¼–è¯‘å‡ºé”™ä¼šåœ¨ç½‘é¡µä¸­æ˜¾ç¤ºå‡ºé”™ä¿¡æ¯é®ç½©</span></span><br><span class="line">        overlay: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// webpack å¡ä½è‡ªåŠ¨åˆ·æ–°é¡µé¢</span></span><br><span class="line">        reload: <span class="literal">true</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    server.use(webpackHotMiddleware(compiler, hotMiddlewareOptions));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">start</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> HOST = <span class="string">'127.0.0.1'</span>;</span><br><span class="line">    <span class="comment">// 4ä¸ªå¤‡é€‰ç«¯å£ï¼Œéƒ½è¢«å ç”¨ä¼šä½¿ç”¨éšæœºç«¯å£</span></span><br><span class="line">    <span class="keyword">const</span> PORT = <span class="keyword">await</span> getPort(&#123; <span class="attr">port</span>: [<span class="number">3000</span>, <span class="number">4000</span>, <span class="number">8080</span>, <span class="number">8888</span>] &#125;);</span><br><span class="line">    <span class="keyword">const</span> address = <span class="string">`http://<span class="subst">$&#123;HOST&#125;</span>:<span class="subst">$&#123;PORT&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŠ è½½ webpack é…ç½®</span></span><br><span class="line">    <span class="keyword">const</span> compiler = webpack(devConfig);</span><br><span class="line">    openBrowser(compiler, address);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> devServer = express();</span><br><span class="line">    setupMiddlewares(compiler, devServer);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> httpServer = devServer.listen(PORT, HOST, err =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="built_in">console</span>.error(err);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// logSymbols.success åœ¨ windows å¹³å°æ¸²æŸ“ä¸º âˆš ï¼Œæ”¯æŒçš„å¹³å°ä¼šæ˜¾ç¤º âœ”</span></span><br><span class="line">        <span class="built_in">console</span>.log(</span><br><span class="line">            <span class="string">`DevServer is running at <span class="subst">$&#123;chalk.magenta.underline(address)&#125;</span> <span class="subst">$&#123;logSymbols.success&#125;</span>`</span>,</span><br><span class="line">        );</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬ç›‘å¬äº† node ä¿¡å·ï¼Œæ‰€ä»¥ä½¿ç”¨ cross-env-shell è€Œä¸æ˜¯ cross-env</span></span><br><span class="line">    <span class="comment">// å‚è€ƒï¼šhttps://github.com/kentcdodds/cross-env#cross-env-vs-cross-env-shell</span></span><br><span class="line">    [<span class="string">'SIGINT'</span>, <span class="string">'SIGTERM'</span>].forEach(<span class="function">(<span class="params">signal: any</span>) =&gt;</span> &#123;</span><br><span class="line">        process.on(signal, () =&gt; &#123;</span><br><span class="line">            <span class="comment">// å…ˆå…³é—­ devServer</span></span><br><span class="line">            httpServer.close();</span><br><span class="line">            <span class="comment">// åœ¨ ctrl + c çš„æ—¶å€™éšæœºè¾“å‡º 'See you again' å’Œ 'Goodbye'</span></span><br><span class="line">            <span class="built_in">console</span>.log(</span><br><span class="line">                chalk.greenBright.bold(<span class="string">`\n<span class="subst">$&#123;<span class="built_in">Math</span>.random() &gt; <span class="number">0.5</span> ? <span class="string">'See you again'</span> : <span class="string">'Goodbye'</span>&#125;</span>!`</span>),</span><br><span class="line">            );</span><br><span class="line">            <span class="comment">// é€€å‡º node è¿›ç¨‹</span></span><br><span class="line">            process.exit();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†™è¿‡ python çš„äººåº”è¯¥ä¸ä¼šé™Œç”Ÿè¿™ç§å†™æ³•</span></span><br><span class="line"><span class="comment">// require.main === module åˆ¤æ–­è¿™ä¸ªæ¨¡å—æ˜¯ä¸æ˜¯è¢«ç›´æ¥è¿è¡Œçš„</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">require</span>.main === <span class="built_in">module</span>) &#123;</span><br><span class="line">    start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>webpackHotMiddleware</code> çš„ <code>overlay</code> é€‰é¡¹æ˜¯ç”¨äºæ˜¯å¦å¼€å¯é”™è¯¯é®ç½©ï¼š</p><p><img data-src="https://i.loli.net/2020/02/20/lLQEXfwgY5khOeM.png" alt="overlay"></p><p>å¾ˆå¤šç»†èŠ‚æˆ‘éƒ½å†™åˆ°æ³¨é‡Šé‡Œé¢äº†ï¼Œå®‰è£…å…¶ä¸­ç”¨åˆ°çš„ä¸€äº›å·¥å…·åº“ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add get-port <span class="built_in">log</span>-symbols open yarg -D</span><br></pre></td></tr></table></figure><p>å‰ä¸‰ä¸ªéƒ½æ˜¯ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NpbmRyZXNvcmh1cw==" title="https://github.com/sindresorhus">sindresorhus<i class="fa fa-external-link"></i></span> å¤§ä½¬çš„ä½œå“ï¼Œ<code>get-port</code> ç”¨äºè·å–å¯ç”¨ç«¯å£ï¼Œ<code>log-symbols</code> æä¾›äº†ä¸‹é¢å››ä¸ª log å­—ç¬¦ï¼Œ<code>open</code> ç”¨äºç³»ç»Ÿåº”ç”¨æ‰“å¼€ <code>uri</code> ï¼ˆ<code>uri</code> åŒ…æ‹¬æ–‡ä»¶å’Œç½‘å€å¤§å®¶åº”è¯¥éƒ½çŸ¥é“ï¼‰, <code>yargs</code> ç”¨äºè§£æå‘½ä»¤è¡Œå‚æ•°ã€‚</p><p><img data-src="https://github.com/sindresorhus/log-symbols/raw/master/screenshot.png" alt="log-symbols"></p><p><code>webpack-dev-middleware</code> å¹¶ä¸æ”¯æŒ <code>webpack-dev-server</code> ä¸­çš„ <code>historyFallback</code> å’Œ <code>proxy</code> åŠŸèƒ½ï¼Œå…¶å®æ— æ‰€è°“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <strong>DIY</strong> æˆ‘ä»¬çš„ express server æ¥å®ç°ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥ä½¿ç”¨ <code>express</code> æ¥é›†æˆ <code>mock</code> åŠŸèƒ½ã€‚å®‰è£…å¯¹åº”çš„ä¸¤ä¸ªä¸­é—´ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add connect-history-api-fallback http-proxy-middleware @types/connect-history-api-fallback @types/http-proxy-middleware -D</span><br></pre></td></tr></table></figure><p><code>connect-history-api-fallback</code> å¯ä»¥ç›´æ¥ä½œä¸º <code>express</code> ä¸­é—´ä»¶é›†æˆåˆ° express serverï¼Œå°è£…ä¸€ä¸‹ <code>http-proxy-middleware</code>ï¼Œå¯ä»¥åœ¨ <code>proxyTable</code> ä¸­æ·»åŠ è‡ªå·±çš„ä»£ç†é…ç½®ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createProxyMiddleware &#125; <span class="keyword">from</span> <span class="string">'http-proxy-middleware'</span>;</span><br><span class="line"><span class="keyword">import</span> chalk <span class="keyword">from</span> <span class="string">'chalk'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; Express &#125; <span class="keyword">from</span> <span class="string">'express'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Options &#125; <span class="keyword">from</span> <span class="string">'http-proxy-middleware/dist/types'</span>;</span><br><span class="line"></span><br><span class="line">interface ProxyTable &#123;</span><br><span class="line">    [path: string]: Options;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> proxyTable: ProxyTable = &#123;</span><br><span class="line">    <span class="comment">// ç¤ºä¾‹é…ç½®</span></span><br><span class="line">    <span class="string">'/path_to_be_proxy'</span>: &#123; <span class="attr">target</span>: <span class="string">'http://target.domain.com'</span>, <span class="attr">changeOrigin</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿®é¥°é“¾æ¥çš„è¾…åŠ©å‡½æ•°, ä¿®æ”¹é¢œè‰²å¹¶æ·»åŠ ä¸‹åˆ’çº¿</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderLink</span>(<span class="params">str: string</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> chalk.magenta.underline(str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">proxy</span>(<span class="params">server: Express</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">Object</span>.entries(proxyTable).forEach(<span class="function">(<span class="params">[path, options]</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">from</span> = path;</span><br><span class="line">        <span class="keyword">const</span> to = options.target <span class="keyword">as</span> string;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`proxy <span class="subst">$&#123;renderLink(<span class="keyword">from</span>)&#125;</span> <span class="subst">$&#123;chalk.green(<span class="string">'-&gt;'</span>)&#125;</span> <span class="subst">$&#123;renderLink(to)&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// eslint-disable-next-line no-param-reassign</span></span><br><span class="line">        <span class="keyword">if</span> (!options.logLevel) options.logLevel = <span class="string">'warn'</span>;</span><br><span class="line">        server.use(path, createProxyMiddleware(options));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœéœ€è¦æ›´çµæ´»çš„å®šä¹‰æ–¹å¼ï¼Œè¯·åœ¨ä¸‹é¢ç›´æ¥ä½¿ç”¨ server.use(path, proxyMiddleware(options)) å®šä¹‰</span></span><br><span class="line">    &#125;);</span><br><span class="line">    process.stdout.write(<span class="string">'\n'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> proxy;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†å¯åŠ¨ devServerï¼Œæˆ‘ä»¬è¿˜éœ€è¦å®‰è£…ä¸¤ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add ts-node cross-env -D</span><br></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1R5cGVTdHJvbmcvdHMtbm9kZQ==" title="https://github.com/TypeStrong/ts-node">ts-node<i class="fa fa-external-link"></i></span> å¯ä»¥è®©æˆ‘ä»¬ç›´æ¥è¿è¡Œ TypeScript ä»£ç ï¼Œ<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2tlbnRjZG9kZHMvY3Jvc3MtZW52Lw==" title="https://github.com/kentcdodds/cross-env/">cross-env<i class="fa fa-external-link"></i></span> æ˜¯ä¸€ä¸ªè·¨æ“ä½œç³»ç»Ÿçš„è®¾ç½®ç¯å¢ƒå˜é‡çš„å·¥å…·ï¼Œæ·»åŠ å¯åŠ¨å‘½ä»¤åˆ° npm scriptï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"scripts"</span>: &#123;</span><br><span class="line">        <span class="string">"start"</span>: <span class="string">"cross-env-shell NODE_ENV=development ts-node --files -P ./scripts/tsconfig.json ./scripts/start.ts --open"</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2tlbnRjZG9kZHMvY3Jvc3MtZW52LyNjcm9zcy1lbnYtdnMtY3Jvc3MtZW52LXNoZWxs" title="https://github.com/kentcdodds/cross-env/#cross-env-vs-cross-env-shell">cross-env<i class="fa fa-external-link"></i></span> å®˜æ–¹æ–‡æ¡£æåˆ°å¦‚æœè¦åœ¨ windows å¹³å°å¤„ç† node ä¿¡å·ä¾‹å¦‚ <code>SIGINT</code>ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ <code>ctrl + c</code> æ—¶è§¦å‘çš„ä¿¡å·åº”è¯¥ä½¿ç”¨ <code>cross-env-shell</code> å‘½ä»¤è€Œä¸æ˜¯ <code>cross-env</code> ã€‚</p><p>ts-node ä¸ºäº†æé«˜æ‰§è¡Œé€Ÿåº¦ï¼Œé»˜è®¤ä¸ä¼šè¯»å– <code>tsconfig.json</code> ä¸­çš„ <code>files</code>, <code>include</code> å’Œ <code>exclude</code> å­—æ®µï¼Œè€Œæ˜¯åŸºäºæ¨¡å—ä¾èµ–è¯»å–çš„ã€‚è¿™ä¼šå¯¼è‡´æˆ‘ä»¬åé¢å†™çš„ä¸€äº›å…¨å±€çš„ <code>.d.ts</code> æ–‡ä»¶ä¸ä¼šè¢«è¯»å–ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®š <code>--files</code> å‚æ•°ï¼Œè¯¦æƒ…å¯ä»¥æŸ¥çœ‹ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1R5cGVTdHJvbmcvdHMtbm9kZSNoZWxwLW15LXR5cGVzLWFyZS1taXNzaW5n" title="https://github.com/TypeStrong/ts-node#help-my-types-are-missing">help-my-types-are-missing<i class="fa fa-external-link"></i></span>ã€‚æˆ‘ä»¬çš„ node ä»£ç å¹¶ä¸å¤šï¼Œè€Œä¸”åˆä¸æ˜¯ç»å¸¸æ€§é‡å¯é¡¹ç›®ï¼Œç›´æ¥è®© ts-node æ‰«ææ•´ä¸ª <code>scripts</code> æ–‡ä»¶å¤¹æ²¡å¤šå¤§å½±å“ã€‚</p><p>å¯åŠ¨æˆ‘ä»¬çš„ dev serverï¼Œé€šè¿‡ ctrl + c é€€å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure><p><img data-src="https://i.loli.net/2020/02/16/DevliamMEKy1hTt.gif" alt="dev server"></p><h2 id="å¼€å‘ç¯å¢ƒä¼˜åŒ–"><a href="#å¼€å‘ç¯å¢ƒä¼˜åŒ–" class="headerlink" title="å¼€å‘ç¯å¢ƒä¼˜åŒ–"></a>å¼€å‘ç¯å¢ƒä¼˜åŒ–</h2><h3 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a>plugins</h3><p>æ¯ä¸ª webpack plugin éƒ½æ˜¯ä¸€ä¸ªåŒ…å« apply æ–¹æ³•çš„ classï¼Œåœ¨æˆ‘ä»¬è°ƒç”¨ <code>compiler.run</code> æˆ–è€… <code>compiler.watch</code> çš„æ—¶å€™å®ƒå°±ä¼šè¢«è°ƒç”¨ï¼Œå¹¶ä¸”æŠŠ compiler ä½œä¸ºå‚æ•°ä¼ å®ƒã€‚compiler å¯¹è±¡æä¾›äº†å„ä¸ªæ—¶æœŸçš„ hooksï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™äº› hooks æŒ‚è½½å›è°ƒå‡½æ•°æ¥å®ç°å„ç§åŠŸèƒ½ï¼Œä¾‹å¦‚å‹ç¼©ï¼Œä¼˜åŒ–ç»Ÿè®¡ä¿¡æ¯ï¼Œåœ¨åœ¨ç¼–è¯‘å®Œå¼¹ä¸ªç¼–è¯‘æˆåŠŸçš„é€šçŸ¥ç­‰ã€‚</p><p><img data-src="https://i.loli.net/2020/02/17/kqngMuoNQWj2CyG.png" alt="hooks"></p><h4 id="æ˜¾ç¤ºæ‰“åŒ…è¿›åº¦"><a href="#æ˜¾ç¤ºæ‰“åŒ…è¿›åº¦" class="headerlink" title="æ˜¾ç¤ºæ‰“åŒ…è¿›åº¦"></a>æ˜¾ç¤ºæ‰“åŒ…è¿›åº¦</h4><p><code>webpack-dev-server</code> åœ¨æ‰“åŒ…æ—¶ä½¿ç”¨ <code>--progress</code> å‚æ•°ä¼šåœ¨æ§åˆ¶å°å®æ—¶è¾“å‡ºç™¾åˆ†æ¯”è¡¨ç¤ºå½“å‰çš„æ‰“åŒ…è¿›åº¦ï¼Œä½†æ˜¯ä»ä¸Šé¢çš„å›¾ä¸­å¯ä»¥çœ‹å‡ºåªæ˜¯è¾“å‡ºäº†ä¸€äº›ç»Ÿè®¡ä¿¡æ¯ï¼ˆstatsï¼‰ã€‚æƒ³è¦å®æ—¶æ˜¾ç¤ºæ‰“åŒ…è¿›åº¦æˆ‘äº†è§£çš„æœ‰ä¸‰ç§æ–¹å¼ï¼š</p><ol><li><p>webpack å†…ç½®çš„ <span class="exturl" data-url="aHR0cHM6Ly93ZWJwYWNrLmRvY3NjaGluYS5vcmcvcGx1Z2lucy9wcm9ncmVzcy1wbHVnaW4=" title="https://webpack.docschina.org/plugins/progress-plugin">webpack.ProgressPlugin<i class="fa fa-external-link"></i></span> æ’ä»¶</p></li><li><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2NsZXNzZy9wcm9ncmVzcy1iYXItd2VicGFjay1wbHVnaW4=" title="https://github.com/clessg/progress-bar-webpack-plugin">progress-bar-webpack-plugin<i class="fa fa-external-link"></i></span></p></li><li><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL251eHQvd2VicGFja2Jhcg==" title="https://github.com/nuxt/webpackbar">webpackbar<i class="fa fa-external-link"></i></span></p></li></ol><p>å†…ç½®çš„ <code>ProgressPlugig</code> éå¸¸çš„åŸå§‹ï¼Œä½ å¯ä»¥åœ¨å›è°ƒå‡½æ•°è·å–å½“å‰è¿›åº¦ï¼Œç„¶åæŒ‰ç…§è‡ªå·±å–œæ¬¢çš„æ ¼å¼å»æ‰“å°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handler = <span class="function">(<span class="params">percentage, message, ...args</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// e.g. Output each progress message directly to the console:</span></span><br><span class="line">  <span class="built_in">console</span>.info(percentage, message, ...args);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">new</span> webpack.ProgressPlugin(handler);</span><br></pre></td></tr></table></figure><p><code>progress-bar-webpack-plugin</code> è¿™ä¸ªæ’ä»¶ä¸æ˜¯æ˜¾ç¤ºç™¾åˆ†æ¯”ï¼Œè€Œæ˜¯æ˜¾ç¤ºä¸€ä¸ªç”¨å­—ç¬¦ç”»å‡ºæ¥çš„è¿›åº¦æ¡ï¼š</p><p><img data-src="https://camo.githubusercontent.com/cb9c82719765ad966a2771f084175c9ec935124e/687474703a2f2f692e696d6775722e636f6d2f4f495031676e6a2e676966" alt="progress-bar-webpack-plugin"></p><p>è¿™ä¸ªæ’ä»¶å…¶å®è¿˜æ˜¯æŒºç®€æ´å®ç”¨çš„ï¼Œä½†æ˜¯æœ‰ä¸ª bug ï¼Œå¦‚æœåœ¨æ‰“å°è¿›åº¦æ¡çš„æ—¶å€™è¾“å‡ºäº†å…¶å®ƒè¯­å¥ï¼Œè¿›åº¦æ¡å°±ä¼šé”™ä½ï¼Œæˆ‘ä»¬çš„ devServer ä¼šåœ¨å¯åŠ¨åä¼šè¾“å‡ºåœ°å€ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">`DevServer is running at <span class="subst">$&#123;chalk.magenta.underline(address)&#125;</span> <span class="subst">$&#123;logSymbols.success&#125;</span>`</span>);</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è¿™ä¸ªè¿›åº¦æ¡æ’ä»¶å°±ä¼šå‡ºé—®é¢˜ä¸‹é¢çš„é—®é¢˜ï¼Œé‚æ”¾å¼ƒã€‚</p><p><img data-src="https://i.loli.net/2020/02/16/MvEgi4sw7WkjbnT.png" alt="progress-bar-webpack-plugin"></p><p><code>webpackbar</code> æ˜¯ nuxt project ä¸‹çš„åº“ï¼ŒèƒŒé  <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL251eHQ=" title="https://github.com/nuxt">nuxt<i class="fa fa-external-link"></i></span>ï¼Œè´¨é‡ç»å¯¹æœ‰ä¿è¯ã€‚æˆ‘ä¹‹å‰æœ‰æ®µæ—¶é—´ç”¨çš„æ˜¯ <code>progress-bar-webpack-plugin</code>ï¼Œå› ä¸ºæˆ‘åœ¨ npm å®˜ç½‘æœç´¢ <code>webpack progress</code>ï¼Œç»¼åˆçœ‹ä¸‹æ¥å°±å®ƒæ¯”è¾ƒé è°±ï¼Œ<code>webpackbar</code> éƒ½æ²¡æœå‡ºæ¥ã€‚ çœ‹äº†ä¸‹ <code>webpackbar</code> çš„ <code>package.json</code>ï¼Œæœç„¶ <code>keywords</code> éƒ½æ˜¯ç©ºçš„ã€‚<code>webpackBar</code> è¿˜æ˜¯æˆ‘åœ¨ç ”ç©¶ <code>ant design</code> çš„ webpack é…ç½®çœ‹åˆ°å®ƒç”¨äº†è¿™ä¸ªæ’ä»¶ï¼Œæ‰å‘ç°äº†è¿™ä¸ªå®è—ï¼š</p><p><img data-src="https://i.loli.net/2020/02/19/MGDZLJBcK2yToN6.png" alt="webpackbar"></p><p>å®‰è£… <code>webpackbar</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add webpackbar @types/webpackbar -D</span><br></pre></td></tr></table></figure><p>æ·»åŠ é…ç½®åˆ° <code>webpack.common.ts</code> çš„ plugins æ•°ç»„ï¼Œé¢œè‰²æˆ‘ä»¬ä½¿ç”¨ react è“ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Configuration &#125; <span class="keyword">from</span> <span class="string">'webpack'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> commonConfig: Configuration = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> WebpackBar(&#123;</span><br><span class="line">      name: <span class="string">'react-typescript-boilerplate'</span>,</span><br><span class="line">      <span class="comment">// react è“</span></span><br><span class="line">      color: <span class="string">'#61dafb'</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="ä¼˜åŒ–æ§åˆ¶å°è¾“å‡º"><a href="#ä¼˜åŒ–æ§åˆ¶å°è¾“å‡º" class="headerlink" title="ä¼˜åŒ–æ§åˆ¶å°è¾“å‡º"></a>ä¼˜åŒ–æ§åˆ¶å°è¾“å‡º</h4><p>æˆ‘ä»¬ä½¿ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dlb3dhcmluL2ZyaWVuZGx5LWVycm9ycy13ZWJwYWNrLXBsdWdpbg==" title="https://github.com/geowarin/friendly-errors-webpack-plugin">friendly-errors-webpack-plugin<i class="fa fa-external-link"></i></span> æ’ä»¶è®©æ§åˆ¶å°çš„è¾“å‡ºæ›´åŠ å‹å¥½ï¼Œä¸‹é¢ä½¿ç”¨äº†ä¹‹åç¼–è¯‘æˆåŠŸæ—¶çš„æ•ˆæœï¼š</p><p><img data-src="https://i.loli.net/2020/02/19/bj9hRKeUBMG1Hmv.png" alt="build successful"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add friendly-errors-webpack-plugin @types/friendly-errors-webpack-plugin -D</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.common.ts</span></span><br><span class="line"><span class="keyword">import</span> FriendlyErrorsPlugin <span class="keyword">from</span> <span class="string">'friendly-errors-webpack-plugin'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> commonConfig: Configuration = &#123;</span><br><span class="line">  plugins: [<span class="keyword">new</span> FriendlyErrorsPlugin()],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="æ„å»ºé€šçŸ¥"><a href="#æ„å»ºé€šçŸ¥" class="headerlink" title="æ„å»ºé€šçŸ¥"></a>æ„å»ºé€šçŸ¥</h4><p><img data-src="https://i.loli.net/2020/02/19/wsWuPkh3x9GlL4a.png" alt="build notification"></p><p>åœ¨æˆ‘å¤§å››å®ä¹ ä¹‹å‰ï¼Œæˆ‘å°±æ²¡å®Œæ•´å†™è¿‡ vue é¡¹ç›®çš„ï¼Œåœ¨ä¸Šå®¶å…¬å¸å®ä¹ çš„é‚£æ®µæ—¶é—´ä¸»è¦å°±æ˜¯å†™ vueï¼Œå½“æ—¶æˆ‘å¯¹ vue-cli é‚£ä¸ªé¢‘ç¹çš„é”™è¯¯é€šçŸ¥å¾ˆåæ„Ÿï¼Œæˆ‘å’ŒåŒäº‹è¯´æˆ‘æƒ³å»æ‰è¿™ä¸ªé€šçŸ¥ï¼Œæ²¡æ›¾æƒ³åŒäº‹éƒ½æ˜¯æ¯”è¾ƒå–œæ¬¢é‚£ä¸ªé€šçŸ¥ï¼Œæ—¢ç„¶æœ‰äººéœ€è¦ï¼Œé‚£æˆ‘ä»¬è¿™ä¸ªé¡¹ç›®ä¹Ÿé…ä¸€ä¸‹ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1JvY2NvQy93ZWJwYWNrLWJ1aWxkLW5vdGlmaWVy" title="https://github.com/RoccoC/webpack-build-notifier">webpack-build-notifier<i class="fa fa-external-link"></i></span> æ¥æ”¯æŒé”™è¯¯é€šçŸ¥ï¼Œè¿™ä¸ªæ’ä»¶æ˜¯ TypeScript å†™çš„ï¼Œä¸éœ€è¦å®‰è£… typesï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add webpack-build-notifier -D</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.common.ts</span></span><br><span class="line"><span class="keyword">import</span> WebpackBuildNotifierPlugin <span class="keyword">from</span> <span class="string">'webpack-build-notifier'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> commonConfig: Configuration = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// suppressSuccess: true è®¾ç½®åªåœ¨ç¬¬ä¸€æ¬¡ç¼–è¯‘æˆåŠŸæ—¶è¾“å‡ºæˆåŠŸçš„é€šçŸ¥, rebuild æˆåŠŸçš„æ—¶å€™ä¸é€šçŸ¥</span></span><br><span class="line">    <span class="keyword">new</span> WebpackBuildNotifierPlugin(&#123; <span class="attr">suppressSuccess</span>: <span class="literal">true</span> &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>å› ä¸ºæˆ‘ä¸å–œæ¬¢å¼¹é€šçŸ¥ï¼Œæ‰€ä»¥æ¨¡æ¿é¡¹ç›®ä¸­çš„æˆ‘æ³¨é‡Šæ‰äº†è¿™ä¸ªæ’ä»¶ï¼Œæœ‰éœ€è¦çš„è‡ªå·±æ‰“å¼€å°±è¡Œäº†ã€‚</p></blockquote><h4 id="ä¸¥æ ¼æ£€æŸ¥è·¯å¾„å¤§å°å†™"><a href="#ä¸¥æ ¼æ£€æŸ¥è·¯å¾„å¤§å°å†™" class="headerlink" title="ä¸¥æ ¼æ£€æŸ¥è·¯å¾„å¤§å°å†™"></a>ä¸¥æ ¼æ£€æŸ¥è·¯å¾„å¤§å°å†™</h4><p>ä¸‹é¢çš„æµ‹è¯•è¡¨æ˜ webpack é»˜è®¤å¯¹è·¯å¾„çš„å¤§å°å†™ä¸æ•æ„Ÿï¼š</p><p><img data-src="https://i.loli.net/2020/02/16/czN2UDhGiXb3TJ5.png" alt="path case"></p><p>æˆ‘ä»¬ä½¿ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1VydGhlbi9jYXNlLXNlbnNpdGl2ZS1wYXRocy13ZWJwYWNrLXBsdWdpbg==" title="https://github.com/Urthen/case-sensitive-paths-webpack-plugin">case-sensitive-paths-webpack-plugin<i class="fa fa-external-link"></i></span> å¯¹è·¯å¾„è¿›è¡Œä¸¥æ ¼çš„å¤§å°å†™æ£€æŸ¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add <span class="keyword">case</span>-sensitive-paths-webpack-plugin @types/<span class="keyword">case</span>-sensitive-paths-webpack-plugin -D</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.common.ts</span></span><br><span class="line"><span class="keyword">import</span> CaseSensitivePathsPlugin <span class="keyword">from</span> <span class="string">'case-sensitive-paths-webpack-plugin'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> commonConfig: Configuration = &#123;</span><br><span class="line">  plugins: [<span class="keyword">new</span> CaseSensitivePathsPlugin()],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img data-src="https://i.loli.net/2020/02/16/FWdazBElvG8Mq4U.png" alt="path-case-check"></p><p>å®é™…æ‰“åŒ…æµ‹è¯•ä¸­å‘ç°è¿™ä¸ªæ’ä»¶éå¸¸è€—æ—¶ï¼Œå¹¶ä¸”å› ä¸º <code>eslint-import-plugin</code> é»˜è®¤ä¼šå¯¹åªæ˜¯å¤§å°å†™ä¸ä¸€æ ·çš„æ¨¡å—è·¯å¾„ä¼šæŠ¥é”™ï¼Œå› æ­¤æˆ‘ä»¬è¿™ä¸ªé¡¹ç›®å°±ä¸é›†æˆäº†ã€‚</p><p><img data-src="https://i.loli.net/2020/04/03/3fLepM1GSBAPjh4.png" alt="case sensitive"></p><h4 id="å¾ªç¯ä¾èµ–æ£€æŸ¥"><a href="#å¾ªç¯ä¾èµ–æ£€æŸ¥" class="headerlink" title="å¾ªç¯ä¾èµ–æ£€æŸ¥"></a>å¾ªç¯ä¾èµ–æ£€æŸ¥</h4><p><img data-src="https://i.loli.net/2020/02/16/bHQEPLK1WiCXlBA.png" alt="circle-dependencies"></p><p>webpack é»˜è®¤ä¸ä¼šå¯¹å¾ªç¯ä¾èµ–æŠ¥é”™ï¼Œé€šè¿‡ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FhY2tlcm1hbi9jaXJjdWxhci1kZXBlbmRlbmN5LXBsdWdpbg==" title="https://github.com/aackerman/circular-dependency-plugin">circular-dependency-plugin <i class="fa fa-external-link"></i></span>è¿™ä¸ª webpack æ’ä»¶å¯ä»¥å¸®æˆ‘ä»¬åŠæ—¶å‘ç°å¾ªç¯ä¾èµ–çš„é—®é¢˜ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add circular-dependency-plugin @types/circular-dependency-plugin -D</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.common.ts</span></span><br><span class="line"><span class="keyword">import</span> CircularDependencyPlugin <span class="keyword">from</span> <span class="string">'circular-dependency-plugin'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; projectRoot, resolvePath &#125; <span class="keyword">from</span> <span class="string">'../env'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> commonConfig: Configuration = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> CircularDependencyPlugin(&#123;</span><br><span class="line">      exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      failOnError: <span class="literal">true</span>,</span><br><span class="line">      allowAsyncCycles: <span class="literal">false</span>,</span><br><span class="line">      cwd: projectRoot,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img data-src="https://i.loli.net/2020/02/16/VOxjym6zZFftkhr.png" alt="circle dependencies error"></p><p>è¿™é‡Œé¡ºä¾¿æä¸€ä¸‹ <code>cwd</code> ä¹Ÿå°±æ˜¯å·¥ä½œè·¯å¾„çš„é—®é¢˜ï¼Œå®˜æ–¹æ–‡æ¡£ç›´æ¥ç”¨ <code>process.cwd()</code>ï¼Œè¿™æ˜¯ä¸€ç§ä¸å¥½çš„åšæ³•ï¼Œé¡¹ç›®è·¯å¾„å’Œå·¥ä½œè·¯å¾„æ˜¯ä¸åŒçš„ä¸¤ä¸ªæ¦‚å¿µã€‚åœ¨ node ä¸­è¡¨ç¤ºé¡¹ç›®è·¯å¾„æ°¸è¿œä¸è¦ç”¨ <code>preocess.cwd()</code>ï¼Œå› ä¸ºæ€»ä¼šæœ‰äº›æ²™é›•ç”¨æˆ·ä¸å»é¡¹ç›®æ ¹ç›®å½•å¯åŠ¨ã€‚<code>process.cwd()</code> ä¹Ÿå°±æ˜¯å·¥ä½œè·¯å¾„è¿”å›çš„æ˜¯ä½ è¿è¡Œ node æ—¶æ‰€åœ¨çš„è·¯å¾„ï¼Œå‡è®¾è¯´é¡¹ç›®åœ¨ <code>/code/projectRoot</code>ï¼Œæœ‰äº›ç”¨æˆ·ç›´æ¥åœ¨ç³»ç»Ÿæ ¹ç›®å½•æ‰“å¼€ terminalï¼Œæ¥ä¸€å¥ <code>node ./code/projectRoot/index.js</code>ï¼Œè¿™æ—¶ <code>index.js</code> ä¸­ <code>process.cwd()</code> è¿”å›çš„æ˜¯å°±æ˜¯ç³»ç»Ÿæ ¹è·¯å¾„ <code>/</code>ï¼Œä¸æ˜¯æœ‰äº›äººè®¤ä¸ºçš„è¿˜æ˜¯ <code>/code/projectRoot</code>ã€‚</p><p>è·å–é¡¹ç›®è·¯å¾„åº”è¯¥ä½¿ç”¨ <code>path.resolve</code>ï¼š</p><p><img data-src="https://i.loli.net/2020/02/19/4wW75dVszApkQGe.png" alt="project root"></p><p>è¿™ä¸ªé—®é¢˜ eslint-import-plugin ä¹Ÿä¼šæŠ¥é”™ï¼Œå¹¶ä¸”åœ¨ TypeScript é¡¹ç›®ä¸­æœ‰æ—¶å€™å°±æ˜¯éœ€è¦å¾ªç¯å¯¼å…¥æ–‡ä»¶ï¼Œå› æ­¤ä¹Ÿä¸é›†æˆã€‚</p><h4 id="æ¸…ç†ä¸Šæ¬¡æ‰“åŒ…çš„-bundle"><a href="#æ¸…ç†ä¸Šæ¬¡æ‰“åŒ…çš„-bundle" class="headerlink" title="æ¸…ç†ä¸Šæ¬¡æ‰“åŒ…çš„ bundle"></a>æ¸…ç†ä¸Šæ¬¡æ‰“åŒ…çš„ bundle</h4><p>å‰é¢ä»‹ç»äº†ä¸€äº›èŠ±é‡Œèƒ¡å“¨çš„æ’ä»¶ï¼Œä¹Ÿä»‹ç»äº†ä¸€äº›è®©æˆ‘ä»¬é¡¹ç›®ä¿æŒå¥åº·çš„æ’ä»¶ï¼Œç°åœ¨æˆ‘ä»¬å¼€å§‹ä»‹ç»ä¸€äº›æ‰“åŒ…ç”¨çš„æ’ä»¶ã€‚</p><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2pvaG5hZ2FuL2NsZWFuLXdlYnBhY2stcGx1Z2lu" title="https://github.com/johnagan/clean-webpack-plugin">clean-webpack-plugin<i class="fa fa-external-link"></i></span> å®ƒä¼šåœ¨ç¬¬ä¸€æ¬¡ç¼–è¯‘çš„æ—¶å€™åˆ é™¤ <code>dist</code> ç›®å½•ä¸­æ‰€æœ‰çš„æ–‡ä»¶ï¼Œä¸è¿‡ä¼šä¿ç•™ <code>dist</code> æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”å†æ¯æ¬¡ <code>rebuild</code> çš„æ—¶å€™ä¼šåˆ é™¤æ‰€æœ‰ä¸å†è¢«ä½¿ç”¨çš„æ–‡ä»¶ã€‚</p><p>è¿™ä¸ªé¡¹ç›®ä¹Ÿæ˜¯ TypeScript å†™çš„ï¼Œæ€»æ„Ÿè§‰ TypeScript å†™çš„é¡¹ç›®æœ‰ç§è«åçš„è¸å®æ„Ÿï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add clean-webpack-plugin -D</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.common.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; CleanWebpackPlugin &#125; <span class="keyword">from</span> <span class="string">'clean-webpack-plugin'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> commonConfig: Configuration = &#123;</span><br><span class="line">  plugins: [<span class="keyword">new</span> CleanWebpackPlugin()],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="è‡ªåŠ¨ç”Ÿæˆ-index-html"><a href="#è‡ªåŠ¨ç”Ÿæˆ-index-html" class="headerlink" title="è‡ªåŠ¨ç”Ÿæˆ index.html"></a>è‡ªåŠ¨ç”Ÿæˆ index.html</h4><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œè…¾è®¯çš„å‰ç«¯é¢è¯•å¾ˆå–œæ¬¢è€ƒè®¡ç®—æœºç½‘ç»œï¼Œæˆ‘æ›¾å¤šæ¬¡è¢«é—®åˆ°è¿‡å¦‚ä½•æ›´æ–°å¼ºç¼“å­˜çš„é—®é¢˜ã€‚è§£å†³å¼ºç¼“å­˜ç«‹å³æ›´æ–°çš„é—®é¢˜æˆ‘ä»¬ä¸€èˆ¬å°±æ˜¯é‡‡å–åœ¨æ–‡ä»¶åä¸­æ’å…¥æ–‡ä»¶å†…å®¹çš„ hash å€¼ï¼Œç„¶åé¦–é¡µä¸ä½¿ç”¨å¼ºç¼“å­˜ã€‚è¿™æ ·åªè¦ä½ æ›´æ–°äº†æŸä¸ªè¢«å¼ºç¼“å­˜çš„èµ„æºæ–‡ä»¶ï¼Œç”±äºæ›´æ–°åå†…å®¹çš„ hash å€¼ä¼šå˜åŒ–ï¼Œç”Ÿæˆçš„æ–‡ä»¶åä¹Ÿä¼šå˜åŒ–ï¼Œè¿™æ ·ä½ è¯·æ±‚é¦–é¡µçš„æ—¶å€™ç”±äºè®¿é—®çš„æ˜¯ä¸€ä¸ªæ–°çš„èµ„æºè·¯å¾„ï¼Œå°±ä¼šå‘æœåŠ¡å™¨è¯·æ±‚æœ€æ–°çš„èµ„æºã€‚å…³äºæµè§ˆå™¨ HTTP ç¼“å­˜å¯ä»¥çœ‹æˆ‘å¦ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://lyreal666.com/é€šè¿‡-koa2-æœåŠ¡å™¨å®è·µæ¢ç©¶æµè§ˆå™¨HTTPç¼“å­˜æœºåˆ¶/">é€šè¿‡-koa2-æœåŠ¡å™¨å®è·µæ¢ç©¶æµè§ˆå™¨ HTTP ç¼“å­˜æœºåˆ¶</a>ã€‚</p><p>æˆ‘ä»¬åç»­ä¼˜åŒ–ç”Ÿäº§ç¯å¢ƒæ„å»ºçš„æ—¶å€™ä¼šå¯¹å°† CSS æ‹†åˆ†æˆå•ç‹¬çš„æ–‡ä»¶ï¼Œå¦‚æœ index.html ä¸­æ’å…¥çš„å¼•å…¥å¤–éƒ¨æ ·å¼çš„ <code>link</code> æ ‡ç­¾çš„ <code>href</code> æ˜¯æˆ‘ä»¬æ‰‹åŠ¨è®¾ç½®çš„ï¼Œé‚£æ¯æ¬¡ä¿®æ”¹æ ·å¼æ–‡ä»¶ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ hash å€¼ï¼Œæˆ‘ä»¬éƒ½è¦æ‰‹åŠ¨å»ä¿®æ”¹è¿™ä¸ªè·¯å¾„ï¼Œå¤ªéº»çƒ¦äº†ï¼Œæ›´ä¸è¦è¯´åœ¨å¼€å‘ç¯å¢ƒä¸‹æ–‡ä»¶æ˜¯ä¿å­˜åœ¨å†…å­˜æ–‡ä»¶ç³»ç»Ÿçš„ï¼Œä½ éƒ½çœ‹ä¸åˆ°æ–‡ä»¶åã€‚</p><p><img data-src="https://i.loli.net/2020/02/19/8OnBuWedj5z2CFP.png" alt="build hash"></p><p>ä½¿ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2phbnRpbW9uL2h0bWwtd2VicGFjay1wbHVnaW4=" title="https://github.com/jantimon/html-webpack-plugin">html-webpack-plugin<i class="fa fa-external-link"></i></span> å¯ä»¥è‡ªåŠ¨ç”Ÿæˆ index.htmlï¼Œå¹¶ä¸”æ’å…¥å¼•ç”¨åˆ°çš„ bundle å’Œè¢«æ‹†åˆ†çš„ CSS ç­‰èµ„æºè·¯å¾„ã€‚</p><p>å‚è€ƒ <code>creat-react-app</code> çš„æ¨¡æ¿ï¼Œæˆ‘ä»¬æ–°å»º <code>public</code> æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­åŠ å…¥ <code>index.html</code>ï¼Œ<code>favico.ico</code>ï¼Œ<code>manifest.json</code> ç­‰æ–‡ä»¶ã€‚<code>public</code> æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾ä¸€äº›å°†è¢«æ‰“åŒ…åˆ° <code>dist</code> æ–‡ä»¶å¤¹ä¸€åŒå‘å¸ƒçš„æ–‡ä»¶ã€‚</p><p>å®‰è£…å¹¶é…ç½® <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2phbnRpbW9uL2h0bWwtd2VicGFjay1wbHVnaW4=" title="https://github.com/jantimon/html-webpack-plugin">html-webpack-plugin<i class="fa fa-external-link"></i></span>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add html-webpack-plugin @types/html-webpack-plugin -D</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> HtmlWebpackPlugin <span class="keyword">from</span> <span class="string">'html-webpack-plugin'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; __DEV__, projectName, resolvePath, projectRoot, hmrPath &#125; <span class="keyword">from</span> <span class="string">'../env'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> htmlMinifyOptions: HtmlMinifierOptions = &#123;</span><br><span class="line">    collapseWhitespace: <span class="literal">true</span>,</span><br><span class="line">    collapseBooleanAttributes: <span class="literal">true</span>,</span><br><span class="line">    collapseInlineTagWhitespace: <span class="literal">true</span>,</span><br><span class="line">    removeComments: <span class="literal">true</span>,</span><br><span class="line">    removeRedundantAttributes: <span class="literal">true</span>,</span><br><span class="line">    removeScriptTypeAttributes: <span class="literal">true</span>,</span><br><span class="line">    removeStyleLinkTypeAttributes: <span class="literal">true</span>,</span><br><span class="line">    minifyCSS: <span class="literal">true</span>,</span><br><span class="line">    minifyJS: <span class="literal">true</span>,</span><br><span class="line">    minifyURLs: <span class="literal">true</span>,</span><br><span class="line">    useShortDoctype: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> commonConfig: Configuration = &#123;</span><br><span class="line">    output: &#123;</span><br><span class="line">        publicPath: <span class="string">'/'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            <span class="comment">// HtmlWebpackPlugin ä¼šè°ƒç”¨ HtmlMinifier å¯¹ HTMl æ–‡ä»¶è¿›è¡Œå‹ç¼©</span></span><br><span class="line">            <span class="comment">// åªåœ¨ç”Ÿäº§ç¯å¢ƒå‹ç¼©</span></span><br><span class="line">            minify: __DEV__ ? <span class="literal">false</span> : htmlMinifyOptions,</span><br><span class="line">            <span class="comment">// æŒ‡å®š html æ¨¡æ¿è·¯å¾„</span></span><br><span class="line">            template: resolvePath(projectRoot, <span class="string">'./public/index.html'</span>),</span><br><span class="line">            <span class="comment">// ç±»å‹ä¸å¥½å®šä¹‰ï¼Œany ä¸€æ—¶çˆ½...</span></span><br><span class="line">            <span class="comment">// å®šä¹‰ä¸€äº›å¯ä»¥åœ¨æ¨¡æ¿ä¸­è®¿é—®çš„æ¨¡æ¿å‚æ•°</span></span><br><span class="line">            templateParameters: <span class="function">(<span class="params">...args: any[]</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> [compilation, assets, assetTags, options] = args;</span><br><span class="line">                <span class="keyword">const</span> rawPublicPath = commonConfig.output!.publicPath!;</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                    compilation,</span><br><span class="line">                    webpackConfig: compilation.options,</span><br><span class="line">                    htmlWebpackPlugin: &#123;</span><br><span class="line">                        tags: assetTags,</span><br><span class="line">                        files: assets,</span><br><span class="line">                        options,</span><br><span class="line">                    &#125;,</span><br><span class="line">        			<span class="comment">// é™¤æ‰ publicPath çš„åæ–œæ ï¼Œè®©ç”¨æˆ·åœ¨æ¨¡æ¿ä¸­æ‹¼æ¥è·¯å¾„æ›´è‡ªç„¶</span></span><br><span class="line">                    PUBLIC_PATH: rawPublicPath.endsWith(<span class="string">'/'</span>)</span><br><span class="line">                        ? rawPublicPath.slice(<span class="number">0</span>, <span class="number">-1</span>)</span><br><span class="line">                        : rawPublicPath,</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;),</span><br><span class="line">    ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†è®©ç”¨æˆ·å¯ä»¥åƒ <code>create-react-app</code> ä¸€æ ·åœ¨ <code>index.html</code> é‡Œé¢é€šè¿‡ <code>PUBLIC_PATH</code> è®¿é—®å‘å¸ƒè·¯å¾„ï¼Œéœ€è¦é…ç½® <code>templateParameters</code> é€‰é¡¹æ·»åŠ  <code>PUBLIC_PATH</code> å˜é‡åˆ°æ¨¡æ¿å‚æ•°ï¼Œ<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2phbnRpbW9uL2h0bWwtd2VicGFjay1wbHVnaW4=" title="https://github.com/jantimon/html-webpack-plugin">html-webpack-plugin<i class="fa fa-external-link"></i></span> é»˜è®¤æ”¯æŒéƒ¨åˆ† ejs è¯­æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼åŠ¨æ€è®¾ç½® <code>favicon.ico</code> , <code>mainfest.json</code> ç­‰èµ„æºè·¯å¾„ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">href</span>=<span class="string">"&lt;%= `$&#123;PUBLIC_PATH&#125;/favicon.ico` %&gt;"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"apple-touch-icon"</span> <span class="attr">href</span>=<span class="string">"&lt;%= `$&#123;PUBLIC_PATH&#125;/logo192.png` %&gt;"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"manifest"</span> <span class="attr">href</span>=<span class="string">"&lt;%= `$&#123;PUBLIC_PATH&#125;/manifest.json` %&gt;"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>React App<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">noscript</span>&gt;</span>You need to enable JavaScript to run this app.<span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="æ‹·è´æ–‡ä»¶åˆ°-dist"><a href="#æ‹·è´æ–‡ä»¶åˆ°-dist" class="headerlink" title="æ‹·è´æ–‡ä»¶åˆ° dist"></a>æ‹·è´æ–‡ä»¶åˆ° dist</h4><p><code>public</code> æ–‡ä»¶å¤¹ä¸­æœ‰ä¸€äº›æ–‡ä»¶ä¾‹å¦‚ <code>favico.icon</code> å’Œ <code>mainfest.json</code> éœ€è¦è¢«æ‹·è´åˆ° <code>dist</code> æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dlYnBhY2stY29udHJpYi9jb3B5LXdlYnBhY2stcGx1Z2lu" title="https://github.com/webpack-contrib/copy-webpack-plugin">copy-webpack-plugin<i class="fa fa-external-link"></i></span> åœ¨ä½¿ç”¨ devServer çš„æƒ…å†µä¸‹å°†æ–‡ä»¶æ‹·è´åˆ°å†…å­˜æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒæ„å»ºçš„æ—¶æ‹·è´åˆ°ç£ç›˜ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add copy-webpack-plugin @types/copy-webpack-plugin -D</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.common.ts</span></span><br><span class="line"><span class="keyword">import</span> CopyPlugin <span class="keyword">from</span> <span class="string">'copy-webpack-plugin'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> commonConfig: Configuration = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> CopyPlugin(</span><br><span class="line">      [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">// æ‰€æœ‰ä¸€çº§æ–‡ä»¶</span></span><br><span class="line">          <span class="keyword">from</span>: <span class="string">'*'</span>,</span><br><span class="line">          to: resolvePath(projectRoot, <span class="string">'./dist'</span>),</span><br><span class="line">          <span class="comment">// ç›®æ ‡ç±»å‹æ˜¯æ–‡ä»¶å¤¹</span></span><br><span class="line">          toType: <span class="string">'dir'</span>,</span><br><span class="line">          <span class="comment">// index.html ä¼šé€šè¿‡ html-webpack-plugin è‡ªåŠ¨ç”Ÿæˆï¼Œæ‰€ä»¥éœ€è¦è¢«å¿½ç•¥æ‰</span></span><br><span class="line">          ignore: [<span class="string">'index.html'</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">      &#123; <span class="attr">context</span>: resolvePath(projectRoot, <span class="string">'./public'</span>) &#125;</span><br><span class="line">    ),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="æ£€æŸ¥-TypeScript-ç±»å‹"><a href="#æ£€æŸ¥-TypeScript-ç±»å‹" class="headerlink" title="æ£€æŸ¥ TypeScript ç±»å‹"></a>æ£€æŸ¥ TypeScript ç±»å‹</h4><p>babel ä¸ºäº†æé«˜ç¼–è¯‘é€Ÿåº¦åªæ”¯æŒ TypeScript è¯­æ³•ç¼–è¯‘è€Œä¸æ”¯æŒç±»å‹æ£€æŸ¥ï¼Œä¸ºäº†åœ¨ webpack æ‰“åŒ…çš„åŒæ—¶æ”¯æŒ ts ç±»å‹æ£€æŸ¥ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ webpack æ’ä»¶ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1R5cGVTdHJvbmcvZm9yay10cy1jaGVja2VyLXdlYnBhY2stcGx1Z2lu" title="https://github.com/TypeStrong/fork-ts-checker-webpack-plugin">fork-ts-checker-webpack-plugin<i class="fa fa-external-link"></i></span>ï¼Œè¿™ä¸ª webpack æ’ä»¶ä¼šåœ¨ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹å¹¶è¡Œçš„è¿›è¡Œ TypeScript çš„ç±»å‹æ£€æŸ¥ï¼Œè¿™ä¸ªé¡¹ç›®ä¹Ÿæ˜¯ TypeScript å†™çš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦å®‰è£… typesã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add fork-ts-checker-webpack-plugin -D</span><br></pre></td></tr></table></figure><p>æ·»åŠ åˆ° <code>webpack.dev.ts</code>ï¼Œé™åˆ¶ä½¿ç”¨çš„å†…å­˜ä¸º 1Gï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ForkTsCheckerWebpackPlugin <span class="keyword">from</span> <span class="string">'fork-ts-checker-webpack-plugin'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> devConfig = merge(commonConfig, &#123;</span><br><span class="line">  mode: <span class="string">'development'</span>,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> ForkTsCheckerWebpackPlugin(&#123;</span><br><span class="line">      memoryLimit: <span class="number">1024</span>,</span><br><span class="line">      <span class="comment">// babel è½¬æ¢çš„æ˜¯æˆ‘ä»¬å‰ç«¯ä»£ç ï¼Œæ‰€ä»¥æ˜¯æŒ‡å‘å‰ç«¯ä»£ç çš„ tsconfig.json</span></span><br><span class="line">      tsconfig: resolvePath(projectRoot, <span class="string">'./src/tsconfig.json'</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>åŒæ—¶ä¿®æ”¹ <code>webpack.prod.ts</code>ï¼Œå› ä¸ºæˆ‘ä»¬ç”Ÿäº§ç¯å¢ƒæ„å»ºå¹¶ä¸ä¼šé•¿æ—¶é—´çš„å ç”¨å†…å­˜ï¼Œæ‰€ä»¥å¯ä»¥è°ƒå¤§ç‚¹ï¼Œæˆ‘ä»¬å°±é»˜è®¤é™åˆ¶ç”Ÿäº§ç¯å¢ƒçš„æ„å»ºä½¿ç”¨çš„å†…å­˜ä¸º 2Gï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.prod.ts</span></span><br><span class="line"><span class="keyword">const</span> prodConfig = merge(commonConfig, &#123;</span><br><span class="line">  mode: <span class="string">'production'</span>,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> ForkTsCheckerWebpackPlugin(&#123;</span><br><span class="line">      memoryLimit: <span class="number">1024</span> * <span class="number">2</span>,</span><br><span class="line">      tsconfig: resolvePath(projectRoot, <span class="string">'./src/tsconfig.json'</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="ç¼“å­˜ç¥å™¨"><a href="#ç¼“å­˜ç¥å™¨" class="headerlink" title="ç¼“å­˜ç¥å™¨"></a>ç¼“å­˜ç¥å™¨</h4><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL216Z29kZGFyZC9oYXJkLXNvdXJjZS13ZWJwYWNrLXBsdWdpbg==" title="https://github.com/mzgoddard/hard-source-webpack-plugin">hard-source-webpack-plugin<i class="fa fa-external-link"></i></span> æ˜¯ä¸€ä¸ªç»™ <code>modules</code> æä¾›ä¸­é—´ç¼“å­˜æ­¥éª¤çš„ webpack æ’ä»¶ï¼Œä¸ºäº†çœ‹åˆ°æ•ˆæœæˆ‘ä»¬å¯èƒ½éœ€è¦è¿è¡Œä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡å°±æ˜¯æ­£å¸¸çš„ç¼–è¯‘é€Ÿåº¦ï¼Œç¬¬äºŒæ¬¡å¯èƒ½ä¼šå¿«ä¸Šå¾ˆå¤šå€ï¼Œæ‹¿æˆ‘å¼€å‘çš„ä¸€ä¸ª <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RqeDY2Ni92aWV3LWdpdGh1Yi1yZXBvc2l0b3J5" title="https://github.com/tjx666/view-github-repository">VSCode æ’ä»¶ <i class="fa fa-external-link"></i></span>æ¥æµ‹è¯•ä¸€ä¸‹ï¼š</p><p>æˆ‘å…ˆæŠŠ <code>node_modules/.cache/hard-source</code> ç¼“å­˜æ–‡ä»¶å¤¹åˆ æ‰ï¼Œçœ‹çœ‹æ²¡æœ‰ç¼“å­˜çš„æ—¶å€™ç¼–è¯‘é€Ÿåº¦ï¼š</p><p><img data-src="https://i.loli.net/2020/02/17/ZucCU1dEev372bS.png" alt="no cache"></p><p>è€—æ—¶ 3.075 ç§’ï¼Œé‡æ–°ç¼–è¯‘ï¼š</p><p><img data-src="https://i.loli.net/2020/02/17/q5B6kUFSm3TyiLl.png" alt="cache"></p><p>å“‡ ğŸš€ï¼Œç›´æ¥å¿«äº† 3.6 å€å¤šâ€¦</p><p>å®æµ‹å‘ç°è¿™ä¸ªæ’ä»¶åœ¨åˆæ¬¡æ‰“åŒ…ä¼šè€—æ—¶ä¸¥é‡ï¼Œå¹¶ä¸”å³å°†å‘å¸ƒçš„ webpack5 å°†å†…ç½®è¿™ä¸ªåŠŸèƒ½ï¼Œå…·ä½“å¯ä»¥çœ‹è¿™ä¸ª issue: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dlYnBhY2svd2VicGFjay9pc3N1ZXMvNjUyNw==" title="https://github.com/webpack/webpack/issues/6527">[spec: webpack 5] - A module disk cache between build processes <i class="fa fa-external-link"></i></span>ã€‚å› æ­¤æˆ‘ä»¬è¿™ä¸ªé¡¹ç›®å°±ä¸é›†æˆè¿™ä¸ªæ’ä»¶äº†ã€‚</p><p>å¥½äº†ï¼Œæ’ä»¶éƒ¨åˆ†ä»‹ç»å®Œäº†ï¼Œæ¥ä¸‹æ¥å¼€å§‹é…ç½® loaders ï¼</p><h3 id="loaders"><a href="#loaders" class="headerlink" title="loaders"></a>loaders</h3><p>webpack é»˜è®¤åªæ”¯æŒå¯¼å…¥ jsï¼Œå¤„ç†ä¸äº†å…¶å®ƒæ–‡ä»¶ï¼Œéœ€è¦é…ç½®å¯¹åº”çš„ loaderï¼Œåƒ <code>excel-loader</code> å°±å¯ä»¥è§£æ excel ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œ<code>file-loader</code> å¯ä»¥è§£æ png å›¾ç‰‡ä¸ºæœ€ç»ˆçš„å‘å¸ƒè·¯å¾„ã€‚loader æ˜¯ä½œç”¨äºä¸€ç±»æ–‡ä»¶çš„ï¼Œplugin æ˜¯ä½œç”¨äº webpack ç¼–è¯‘çš„å„ä¸ªæ—¶æœŸã€‚</p><p>å‰é¢æˆ‘ä»¬åªé…ç½®äº† <code>babel-loader</code>ï¼Œ ä½¿å¾— webpack èƒ½å¤Ÿå¤„ç† TypeScript æ–‡ä»¶ï¼Œå®é™…çš„å¼€å‘ä¸­æˆ‘ä»¬è¿˜éœ€è¦æ”¯æŒå¯¼å…¥æ ·å¼æ–‡ä»¶ï¼Œå›¾ç‰‡æ–‡ä»¶ï¼Œå­—ä½“æ–‡ä»¶ç­‰ã€‚</p><h4 id="å¤„ç†æ ·å¼æ–‡ä»¶"><a href="#å¤„ç†æ ·å¼æ–‡ä»¶" class="headerlink" title="å¤„ç†æ ·å¼æ–‡ä»¶"></a>å¤„ç†æ ·å¼æ–‡ä»¶</h4><p>æˆ‘ä»¬æœ€ç»ˆè¦è¾¾åˆ°çš„ç›®æ ‡æ˜¯æ”¯æŒ css/less/sass ä¸‰ç§è¯­æ³•ï¼Œä»¥åŠé€šè¿‡ <code>postcss</code> å’Œ <code>autoprefixer</code> æ’ä»¶å®ç°è‡ªåŠ¨è¡¥é½æµè§ˆå™¨å¤´ç­‰åŠŸèƒ½ã€‚</p><h5 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h5><p>å¤„ç† css æ–‡ä»¶æˆ‘ä»¬éœ€è¦å®‰è£… <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dlYnBhY2stY29udHJpYi9zdHlsZS1sb2FkZXI=" title="https://github.com/webpack-contrib/style-loader">style-loader<i class="fa fa-external-link"></i></span> å’Œ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dlYnBhY2stY29udHJpYi9jc3MtbG9hZGVy" title="https://github.com/webpack-contrib/css-loader">css-loader<i class="fa fa-external-link"></i></span>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add css-loader style-loader -D</span><br></pre></td></tr></table></figure><p><code>css-loader</code> ä½œç”¨æ˜¯å¤„ç† CSS æ–‡ä»¶ä¸­çš„ <code>@import</code> å’Œ <code>url()</code> è¿”å›ä¸€ä¸ªåˆå¹¶åçš„ CSS å­—ç¬¦ä¸²ï¼Œè€Œ <code>style-loader</code> è´Ÿè´£å°†è¿”å›çš„ CSS å­—ç¬¦ä¸²ç”¨ <code>style</code> æ ‡ç­¾æ’åˆ° DOM ä¸­ï¼Œå¹¶ä¸”è¿˜å®ç°äº† webpack çš„çƒ­æ›´æ–°æ¥å£ã€‚</p><p><code>style-loader</code> å®˜æ–¹ç¤ºä¾‹é…ç½®æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// i åç¼€å¿½ç•¥å¤§å°å†™</span></span><br><span class="line">        test: <span class="regexp">/\.css$/i</span>,</span><br><span class="line">        use: [<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åŒ¹é…æ­£åˆ™ç”¨äº† <code>i</code> åç¼€ï¼Œæˆ‘è§‰å¾—è¿™æ ·ä¸å¥½ï¼Œä¸åº”è¯¥æé«˜ä¸€äº›æ— æ„ä¹‰çš„å®¹é”™ç‡ï¼Œç”¨<code>.CSS</code> åšåç¼€å°±ä¸åº”è¯¥è®© webpack ç¼–è¯‘é€šè¿‡ã€‚æˆ‘ä»¬çŸ¥é“ webpack çš„ loaders åŠ è½½é¡ºåºæ˜¯ä»å³åˆ°å·¦çš„ï¼Œæ‰€ä»¥éœ€è¦å…ˆæ‰§è¡Œçš„ <code>css-loader</code> åº”è¯¥åœ¨åæ‰§è¡Œçš„ <code>style-loader</code> åé¢ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.common.ts</span></span><br><span class="line"><span class="keyword">const</span> commonConfig: Configuration = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="string">'style-loader'</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'css-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              <span class="comment">// CSS modules æ¯”è¾ƒè€—æ€§èƒ½ï¼Œé»˜è®¤å°±æ˜¯ç¦ç”¨çš„</span></span><br><span class="line">              modules: <span class="literal">false</span>,</span><br><span class="line">              <span class="comment">// å¼€å¯ sourcemap</span></span><br><span class="line">              sourceMap: <span class="literal">true</span>,</span><br><span class="line">              <span class="comment">// æŒ‡å®šåœ¨ CSS loader å¤„ç†å‰ä½¿ç”¨çš„ laoder æ•°é‡</span></span><br><span class="line">              importLoaders: <span class="number">0</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="less"><a href="#less" class="headerlink" title="less"></a>less</h5><p><code>less-loader</code> ä¾èµ– <code>less</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add less less-loader -D</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.common.ts</span></span><br><span class="line"><span class="keyword">const</span> commonConfig: Configuration = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="string">'style-loader'</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'css-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              modules: <span class="literal">false</span>,</span><br><span class="line">              sourceMap: <span class="literal">true</span>,</span><br><span class="line">              <span class="comment">// éœ€è¦å…ˆè¢« less-loader å¤„ç†ï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®ä¸º 1</span></span><br><span class="line">              importLoaders: <span class="number">1</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// å…ˆè®© less-loader å°† less æ–‡ä»¶è½¬æ¢æˆ css æ–‡ä»¶</span></span><br><span class="line">            <span class="comment">// å†äº¤ç»™ css-loader å¤„ç†</span></span><br><span class="line">            loader: <span class="string">'less-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              sourceMap: <span class="literal">true</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="sass"><a href="#sass" class="headerlink" title="sass"></a>sass</h5><p>å…¶å®æˆ‘æœ¬äººä»æ¥ä¸ç”¨ <code>less</code> å’Œ <code>stylus</code>ï¼Œæˆ‘ä¸€ç›´ç”¨çš„æ˜¯ <code>sass</code>ã€‚<code>sass</code> æœ‰ä¸¤ç§è¯­æ³•æ ¼å¼ï¼Œé€šè¿‡åç¼€ååŒºåˆ†ã€‚<code>.sass</code> åç¼€åæ˜¯ç±»ä¼¼ <code>yml</code> çš„ç¼©è¿›å†™æ³•ï¼Œ<code>.scss</code> æ˜¯ç±»ä¼¼äº CSS çš„èŠ±æ‹¬å·å†™æ³•ï¼Œä¸è¿‡æ”¯æŒåµŒå¥—å’Œå˜é‡ç­‰ç‰¹æ€§ã€‚é‰´äºæˆ‘åŸºæœ¬ä¸Šæ²¡çœ‹è¿‡å“ªä¸ªé¡¹ç›®ç”¨ <code>yml</code> æ ¼å¼çš„å†™æ³•ï¼Œç”¨çš„äººå¤ªå°‘äº†ï¼Œæˆ‘ä»¬æ¨¡æ¿å°±åªæ”¯æŒ <code>scss</code> åç¼€å¥½äº†ã€‚<code>sass-loader</code> åŒæ ·ä¾èµ– <code>node-sass</code>ï¼Œ<code>node-sass</code> çœŸæ˜¯ä¸ªç¢§æ± ï¼Œæ²¡æœ‰ä»£ç†è¿˜å®‰è£…ä¸äº†ï¼Œæ‰€ä»¥æˆ‘åœ¨ç³»åˆ—ç¬¬ä¸€ç¯‡å°±åœ¨ <code>.npmrc</code> å°±é…ç½®äº† <code>node-sass</code> çš„é•œåƒï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add node-sass sass-loader -D</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.common.ts</span></span><br><span class="line"><span class="keyword">const</span> commonConfig: Configuration = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="string">'style-loader'</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'css-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              modules: <span class="literal">false</span>,</span><br><span class="line">              sourceMap: <span class="literal">true</span>,</span><br><span class="line">              importLoaders: <span class="number">1</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'sass-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              <span class="comment">// ä¸­é—´æ¯ä¸ª loader éƒ½è¦å¼€å¯ sourcemapï¼Œæ‰èƒ½ç”Ÿæˆæ­£ç¡®çš„ soucemap</span></span><br><span class="line">              sourceMap: <span class="literal">true</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="postcss"><a href="#postcss" class="headerlink" title="postcss"></a>postcss</h5><p><img data-src="https://i.loli.net/2020/02/20/Mxsl8rQdU1tNiYm.png" alt="browser prefix"></p><p>è®°å¾—æˆ‘åœ¨å¤§ä¸€ä¸Šç½‘é¡µè®¾è®¡è¯¾å­¦åˆ° CSS3 çš„æ—¶å€™ï¼Œå¾ˆå¤šå±æ€§éƒ½è¦åŠ æµè§ˆå™¨å¤´å¤„ç†å…¼å®¹æ€§ï¼Œå½“æ—¶å°±å¯¹ CSS å…´è¶£å¤§å‡ï¼Œå¤ªéº»çƒ¦äº†ã€‚è‡ªä» node çš„å‡ºç°ï¼Œå‰ç«¯å·¥ç¨‹åŒ–å¼€å§‹é£é€Ÿå‘å±•ï¼Œä»¥å‰å‰ç«¯è€è¢«å«åšåˆ‡å›¾ä»”ï¼Œç°åœ¨å‰ç«¯å·¥ç¨‹å¸ˆä¹Ÿå¯ä»¥ç”¨ node åšä¼ªå…¨æ ˆå¼€å‘äº†ã€‚</p><p><strong>postcss</strong> æ˜¯ CSS åå¤„ç†å™¨å·¥å…·ï¼Œå› ä¸ºå…ˆæœ‰ CSSï¼Œ<code>postcss</code> åå»å¤„ç†å®ƒï¼Œæ‰€ä»¥å«åå¤„ç†å™¨ã€‚</p><p><strong>less/sass</strong> è¢«ç§°ä¹‹ä¸º CSS é¢„å¤„ç†å™¨ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦è¢« <code>less</code> æˆ– <code>node-sass</code> é¢„å…ˆç¼–è¯‘ä»£ç åˆ° CSS å˜›ã€‚</p><p>å‚è€ƒ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL2NyZWF0ZS1yZWFjdC1hcHAvYmxvYi9tYXN0ZXIvcGFja2FnZXMvcmVhY3Qtc2NyaXB0cy9jb25maWcvd2VicGFjay5jb25maWcuanMjTDk2" title="https://github.com/facebook/create-react-app/blob/master/packages/react-scripts/config/webpack.config.js#L96">create-react-app å¯¹ postcss çš„é…ç½®<i class="fa fa-external-link"></i></span>ï¼Œå®‰è£…ä»¥ä¸‹æ’ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add postcss-loader postcss-flexbugs-fixes postcss-preset-env autoprefixer postcss-normalize -D</span><br></pre></td></tr></table></figure><p>æ·»åŠ  <code>postcss.config.js</code> ç”¨äºé…ç½® <code>postcss</code>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// ä¿®å¤ä¸€äº›å’Œ flex å¸ƒå±€ç›¸å…³çš„ bug</span></span><br><span class="line">    <span class="built_in">require</span>(<span class="string">'postcss-flexbugs-fixes'</span>),</span><br><span class="line">    <span class="comment">// å‚è€ƒ browserslist çš„æµè§ˆå™¨å…¼å®¹è¡¨è‡ªåŠ¨å¯¹é‚£äº›è¿˜ä¸æ”¯æŒçš„ç°ä»£ CSS ç‰¹æ€§åšè½¬æ¢</span></span><br><span class="line">    <span class="built_in">require</span>(<span class="string">'postcss-preset-env'</span>)(&#123;</span><br><span class="line">      <span class="comment">// è‡ªåŠ¨æ·»åŠ æµè§ˆå™¨å¤´</span></span><br><span class="line">      autoprefixer: &#123;</span><br><span class="line">        <span class="comment">// will add prefixes only for final and IE versions of specification</span></span><br><span class="line">        flexbox: <span class="string">'no-2009'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      stage: <span class="number">3</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// æ ¹æ® browserslist è‡ªåŠ¨å¯¼å…¥éœ€è¦çš„ normalize.css å†…å®¹</span></span><br><span class="line">    <span class="built_in">require</span>(<span class="string">'postcss-normalize'</span>),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜éœ€è¦æ·»åŠ  <code>browserslist</code> é…ç½®åˆ° <code>package.json</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"browserslist"</span>: [</span><br><span class="line">        <span class="string">"last 2 versions"</span>,</span><br><span class="line">        <span class="comment">// ESRï¼ˆExtended Support Releaseï¼‰ é•¿æœŸæ”¯æŒç‰ˆæœ¬</span></span><br><span class="line">        <span class="string">"Firefox ESR"</span>,</span><br><span class="line">        <span class="string">"&gt; 1%"</span>,</span><br><span class="line">        <span class="string">"ie &gt;= 11"</span></span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å›é¡¾ CSSï¼Œ lessï¼Œsass çš„é…ç½®å¯ä»¥çœ‹åˆ°æœ‰å¤§é‡çš„é‡å¤ï¼Œæˆ‘ä»¬é‡æ„å¹¶ä¿®æ”¹ <code>importLoaders</code> é€‰é¡¹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCssLoaders</span>(<span class="params">importLoaders: number</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    <span class="string">'style-loader'</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">'css-loader'</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        modules: <span class="literal">false</span>,</span><br><span class="line">        sourceMap: <span class="literal">true</span>,</span><br><span class="line">        importLoaders,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">'postcss-loader'</span>,</span><br><span class="line">      options: &#123; <span class="attr">sourceMap</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> commonConfig: Configuration = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: getCssLoaders(<span class="number">1</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="comment">// postcss-loader + less-loader ä¸¤ä¸ª loaderï¼Œæ‰€ä»¥ importLoaders åº”è¯¥è®¾ç½®ä¸º 2</span></span><br><span class="line">          ...getCssLoaders(<span class="number">2</span>),</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'less-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              sourceMap: <span class="literal">true</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          ...getCssLoaders(<span class="number">2</span>),</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'sass-loader'</span>,</span><br><span class="line">            options: &#123; <span class="attr">sourceMap</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="å¤„ç†å›¾ç‰‡å’Œå­—ä½“"><a href="#å¤„ç†å›¾ç‰‡å’Œå­—ä½“" class="headerlink" title="å¤„ç†å›¾ç‰‡å’Œå­—ä½“"></a>å¤„ç†å›¾ç‰‡å’Œå­—ä½“</h4><p>ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬çš„é¡¹ç›®åœ¨å¼€å‘çš„æ—¶å€™ä¼šä½¿ç”¨ä¸€äº›å›¾ç‰‡æ¥æµ‹è¯•æ•ˆæœï¼Œæ­£å¼ä¸Šçº¿å†æ›¿æ¢æˆ CDN è€Œä¸æ˜¯ä½¿ç”¨ webpack æ‰“åŒ…çš„æœ¬åœ°å›¾ç‰‡ã€‚å¤„ç†æ–‡ä»¶çš„å¸¸ç”¨ loader æœ‰ä¿©ï¼Œ<code>file-loader</code> å’Œ <code>url-loader</code>ï¼Œ<code>file-loader</code> ç”¨äºè§£æå¯¼å…¥çš„æ–‡ä»¶ä¸ºå‘å¸ƒæ—¶çš„ urlï¼Œ å¹¶å°†æ–‡ä»¶è¾“å‡ºåˆ°æŒ‡å®šçš„ä½ç½®ï¼Œè€Œåè€…æ˜¯å¯¹å‰è€…çš„å°è£…ï¼Œæä¾›äº†å°†ä½äºé˜ˆå€¼ä½“ç§¯(ä¸‹é¢å°±è®¾ç½®ä¸º 8192 ä¸ªå­—èŠ‚ï¼‰çš„å›¾ç‰‡è½¬æ¢æˆ base64ã€‚æˆ‘å¿½ç„¶æƒ³èµ·ä»¥å‰è…¾è®¯çš„ä¸€ä¸ªé¢è¯•å®˜é—®è¿‡è¿™ä¹ˆä¸ªé—®é¢˜ï¼šä½¿ç”¨ base64 æœ‰ä»€ä¹ˆåå¤„å—ï¼Ÿå…¶å®æˆ‘è§‰å¾— base64 å¥½å¤„å°±æ˜¯ä¸ç”¨äºŒæ¬¡è¯·æ±‚ï¼Œåå¤„å°±æ˜¯å›¾ç‰‡è½¬ base64 ä½“ç§¯åè€Œä¼šå˜å¤§ï¼Œå˜æˆåŸæ¥çš„ä¸‰åˆ†ä¹‹å››å€ã€‚</p><p><img data-src="https://i.loli.net/2020/02/20/IouO1Kvt5wFAWVl.png" alt="base64"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add url-loader -D</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> commonConfig: Configuration = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: [<span class="regexp">/\.bmp$/</span>, /\.gif$/, /\.jpe?g$/, /\.png$/],</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              <span class="comment">// å›¾ç‰‡ä½äº 10k ä¼šè¢«è½¬æ¢æˆ base64 æ ¼å¼çš„ dataUrl</span></span><br><span class="line">              limit: <span class="number">10</span> * <span class="number">1024</span>,</span><br><span class="line">              <span class="comment">// [hash] å ä½ç¬¦å’Œ [contenthash] æ˜¯ç›¸åŒçš„å«ä¹‰</span></span><br><span class="line">              <span class="comment">// éƒ½æ˜¯è¡¨ç¤ºæ–‡ä»¶å†…å®¹çš„ hash å€¼ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨ md5 hash ç®—æ³•</span></span><br><span class="line">              name: <span class="string">'[name].[contenthash].[ext]'</span>,</span><br><span class="line">              <span class="comment">// ä¿å­˜åˆ° images æ–‡ä»¶å¤¹ä¸‹é¢</span></span><br><span class="line">              outputPath: <span class="string">'images'</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(ttf|woff|woff2|eot|otf)$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              name: <span class="string">'[name]-[contenthash].[ext]'</span>,</span><br><span class="line">              outputPath: <span class="string">'fonts'</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°æˆ‘è¿™é‡Œæ–‡ä»¶åä¸­éƒ½æ’å…¥äº†æ–‡ä»¶å†…å®¹ hash å€¼ï¼Œè¿™æ ·å°±å¯ä»¥è§£å†³<strong>å¼ºç¼“å­˜éœ€è¦ç«‹å³æ›´æ–°</strong>çš„é—®é¢˜ã€‚</p><h3 id="sourcemap"><a href="#sourcemap" class="headerlink" title="sourcemap"></a>sourcemap</h3><table><thead><tr><th>devtool</th><th>æ„å»ºé€Ÿåº¦</th><th>é‡æ–°æ„å»ºé€Ÿåº¦</th><th>ç”Ÿäº§ç¯å¢ƒ</th><th>å“è´¨(quality)</th></tr></thead><tbody><tr><td>(none)</td><td>+++</td><td>+++</td><td>yes</td><td>æ‰“åŒ…åçš„ä»£ç </td></tr><tr><td>eval</td><td>+++</td><td>+++</td><td>no</td><td>ç”Ÿæˆåçš„ä»£ç </td></tr><tr><td>cheap-eval-source-map</td><td>+</td><td>++</td><td>no</td><td>è½¬æ¢è¿‡çš„ä»£ç ï¼ˆä»…é™è¡Œï¼‰</td></tr><tr><td>cheap-module-eval-source-map</td><td>o</td><td>++</td><td>no</td><td>åŸå§‹æºä»£ç ï¼ˆä»…é™è¡Œï¼‰</td></tr><tr><td>eval-source-map</td><td>â€“</td><td>+</td><td>no</td><td>åŸå§‹æºä»£ç </td></tr><tr><td>cheap-source-map</td><td>+</td><td>o</td><td>yes</td><td>è½¬æ¢è¿‡çš„ä»£ç ï¼ˆä»…é™è¡Œï¼‰</td></tr><tr><td>cheap-module-source-map</td><td>o</td><td>-</td><td>yes</td><td>åŸå§‹æºä»£ç ï¼ˆä»…é™è¡Œï¼‰</td></tr><tr><td>inline-cheap-source-map</td><td>+</td><td>o</td><td>no</td><td>è½¬æ¢è¿‡çš„ä»£ç ï¼ˆä»…é™è¡Œï¼‰</td></tr><tr><td>inline-cheap-module-source-map</td><td>o</td><td>-</td><td>no</td><td>åŸå§‹æºä»£ç ï¼ˆä»…é™è¡Œï¼‰</td></tr><tr><td>source-map</td><td>â€“</td><td>â€“</td><td>yes</td><td>åŸå§‹æºä»£ç </td></tr><tr><td>inline-source-map</td><td>â€“</td><td>â€“</td><td>no</td><td>åŸå§‹æºä»£ç </td></tr><tr><td>hidden-source-map</td><td>â€“</td><td>â€“</td><td>yes</td><td>åŸå§‹æºä»£ç </td></tr><tr><td>nosources-source-map</td><td>â€“</td><td>â€“</td><td>yes</td><td>æ— æºä»£ç å†…å®¹</td></tr></tbody></table><blockquote><p><code>+++</code> éå¸¸å¿«é€Ÿ, <code>++</code> å¿«é€Ÿ, <code>+</code> æ¯”è¾ƒå¿«, <code>o</code> ä¸­ç­‰, <code>-</code> æ¯”è¾ƒæ…¢, <code>--</code> æ…¢</p></blockquote><p>sourcemap æ˜¯ç°åœ¨å‰ç«¯ç•Œå¾ˆå¤šå·¥å…·å¿…ä¸å¯ç¼ºçš„ä¸€ä¸ªåŠŸèƒ½ï¼Œwebpackï¼ŒTypeScriptï¼Œbabelï¼Œpowser-assert ç­‰è½¬æ¢ä»£ç çš„å·¥å…·éƒ½è¦æä¾› sourcemap åŠŸèƒ½ï¼Œæºä»£ç è¢«å‹ç¼©ï¼Œæ··æ·†ï¼Œpolyfillï¼Œæ²¡æœ‰ sourcemapï¼Œæ ¹æœ¬æ²¡åŠæ³•è°ƒè¯•å®šä½é—®é¢˜ã€‚</p><p>è€ƒè™‘åˆ°ç¼–è¯‘é€Ÿåº¦ï¼Œè°ƒå¼å‹å¥½æ€§ï¼Œæˆ‘é€‰æ‹© <code>eval-source-map</code>ï¼Œå¦‚æœç”¨æˆ·åœ¨æ‰“åŒ…æ—¶è§‰å¾—æ…¢ï¼Œè€Œä¸”èƒ½å¤Ÿå¿å—æ²¡æœ‰åˆ—å·ï¼Œå¯ä»¥è€ƒè™‘è°ƒæˆ <code>cheap-eval-source-map</code>ã€‚</p><p>æˆ‘ä»¬ä¿®æ”¹ <code>webpack.dev.ts</code> çš„ devtool ä¸º <code>eval-source-map</code>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.dev.ts</span></span><br><span class="line"><span class="keyword">import</span> commonConfig <span class="keyword">from</span> <span class="string">'./webpack.common'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> devConfig = merge(commonConfig, &#123;</span><br><span class="line">  devtool: <span class="string">'eval-source-map'</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¡ºä¾¿æä¸€ä¸‹ webpack æ’ä»¶ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Ntb290aC1jb2RlL2Vycm9yLW92ZXJsYXktd2VicGFjay1wbHVnaW4=" title="https://github.com/smooth-code/error-overlay-webpack-plugin">error-overlay-webpack-plugin<i class="fa fa-external-link"></i></span>ï¼Œå®ƒæä¾›äº†å’Œ create-react-app ä¸€æ ·çš„é”™è¯¯é®ç½©ï¼š</p><p><img data-src="https://raw.githubusercontent.com/smooth-code/error-overlay-webpack-plugin/master/docs/example.png" alt="error overlay"></p><p>ä½†æ˜¯å®ƒæœ‰ä¸€ä¸ªé™åˆ¶å°±æ˜¯ä¸èƒ½ä½¿ç”¨ä»»ä½•ä¸€ç§åŸºäº <code>eval</code> çš„ sourcemapï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥å°è¯•ä»¥ä¸‹ã€‚</p><h3 id="çƒ­æ›´æ–°"><a href="#çƒ­æ›´æ–°" class="headerlink" title="çƒ­æ›´æ–°"></a>çƒ­æ›´æ–°</h3><p>æˆ‘ä»¬å‰é¢ç»™ devServer æ·»åŠ äº† <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dlYnBhY2stY29udHJpYi93ZWJwYWNrLWhvdC1taWRkbGV3YXJl" title="https://github.com/webpack-contrib/webpack-hot-middleware">webpack-hot-middleware<i class="fa fa-external-link"></i></span> ä¸­é—´ä»¶ï¼Œå‚è€ƒå®ƒçš„æ–‡æ¡£æˆ‘ä»¬éœ€è¦å…ˆæ·»åŠ  webapck æ’ä»¶<code>webpack.HotModuleReplacementPlugin</code>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.dev.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; HotModuleReplacementPlugin, NamedModulesPlugin &#125; <span class="keyword">from</span> <span class="string">'webpack'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> devConfig = merge(commonConfig, &#123;</span><br><span class="line">  plugins: [<span class="keyword">new</span> HotModuleReplacementPlugin()],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿˜è¦æ·»åŠ  <code>&#39;webpack-hot-middleware/client&#39;</code> çƒ­æ›´æ–°è¡¥ä¸åˆ°æˆ‘ä»¬çš„ bundleï¼ŒåŠ å…¥ entry æ•°ç»„å³å¯ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.common.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; __DEV__, hmrPath &#125; <span class="keyword">from</span> <span class="string">'../env'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> commonConfig: Configuration = &#123;</span><br><span class="line">    entry: [resolvePath(projectRoot, <span class="string">'./src/index.tsx'</span>)],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">    (commonConfig.entry <span class="keyword">as</span> string[]).unshift(<span class="string">`webpack-hot-middleware/client?path=<span class="subst">$&#123;hmrPath&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡åœ¨ entry åé¢åŠ  <code>queryString</code> çš„æ–¹å¼å¯ä»¥è®©æˆ‘ä»¬é…ç½®ä¸€äº›é€‰é¡¹ï¼Œå®ƒæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼ŸæŸ¥çœ‹ <code>&#39;webpack-hot-middleware/client&#39;</code> æºç å¯ä»¥çœ‹åˆ°ï¼Œwebpack ä¼šå°† <code>queryString</code> ä½œä¸ºå…¨å±€å˜é‡æ³¨å…¥è¿™ä¸ªæ–‡ä»¶ï¼š</p><p><img data-src="https://i.loli.net/2020/02/18/h1njS2olHADUV8R.png" alt="entry query"></p><p>å…¶å®åˆ°è¿™æˆ‘ä»¬ä¹Ÿå°±æ”¯æŒäº† CSS çš„çƒ­æ›´æ–°ï¼ˆstyle-loader å®ç°äº†çƒ­æ›´æ–°æ¥å£ï¼‰ï¼Œå¦‚æœè¦æ”¯æŒ react ç»„ä»¶çš„çƒ­æ›´æ–°æˆ‘ä»¬è¿˜éœ€è¦é…ç½® <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dhZWFyb24vcmVhY3QtaG90LWxvYWRlcg==" title="https://github.com/gaearon/react-hot-loader">react-hot-loader<i class="fa fa-external-link"></i></span> ï¼Œé…ç½®å®ƒä¹‹å‰æˆ‘ä»¬å…ˆæ¥ä¼˜åŒ–æˆ‘ä»¬çš„ babel é…ç½®ã€‚</p><h3 id="babel-é…ç½®ä¼˜åŒ–"><a href="#babel-é…ç½®ä¼˜åŒ–" class="headerlink" title="babel é…ç½®ä¼˜åŒ–"></a>babel é…ç½®ä¼˜åŒ–</h3><p>å‰é¢æˆ‘ä»¬åœ¨å‰é¢åªé…ç½®äº†ä¸€ä¸ª <code>@babel/preset-typescript</code> æ’ä»¶ç”¨äºç¼–è¯‘ TypeScriptï¼Œå…¶å®è¿˜æœ‰å¾ˆå¤šå¯ä»¥ä¼˜åŒ–çš„ç‚¹ã€‚</p><h4 id="babel-preset-env"><a href="#babel-preset-env" class="headerlink" title="@babel/preset-env"></a>@babel/preset-env</h4><p>åœ¨ babel ä¸­ï¼Œ<strong>preset è¡¨ç¤º plugin çš„é›†åˆ</strong>ï¼Œ<code>@babel/preset-env</code> å¯ä»¥è®© babel æ ¹æ®æˆ‘ä»¬é…ç½®çš„ browserslist åªæ·»åŠ éœ€è¦è½¬æ¢çš„è¯­æ³•å’Œ polyfillã€‚</p><p>å®‰è£… <code>@babel/preset-env</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add @babel/preset-env -D</span><br></pre></td></tr></table></figure><h4 id="babel-plugin-transform-runtime"><a href="#babel-plugin-transform-runtime" class="headerlink" title="@babel/plugin-transform-runtime"></a>@babel/plugin-transform-runtime</h4><p>æˆ‘ä»¬çŸ¥é“é»˜è®¤æƒ…å†µä¸‹ï¼Œ babel åœ¨ç¼–è¯‘æ¯ä¸€ä¸ªæ¨¡å—çš„æ—¶å€™åœ¨éœ€è¦çš„æ—¶å€™ä¼šæ’å…¥ä¸€äº›è¾…åŠ©å‡½æ•°ä¾‹å¦‚ <code>_extend</code>ï¼Œæ¯ä¸€ä¸ªéœ€è¦çš„æ¨¡å—éƒ½ä¼šç”Ÿæˆè¿™ä¸ªè¾…åŠ©å‡½æ•°ä¼šé€ æˆæ²¡å¿…è¦çš„ä»£ç è†¨èƒ€ï¼Œ<code>@babel/plugin-transform-runtime</code> è¿™ä¸ªæ’ä»¶ä¼šå°†æ‰€æœ‰çš„è¾…åŠ©å‡½æ•°éƒ½ä» <code>@babel/runtime</code> å¯¼å…¥ï¼Œæ¥å‡å°‘ä»£ç ä½“ç§¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add @babel/plugin-transform-runtime -D</span><br></pre></td></tr></table></figure><h4 id="babel-preset-react"><a href="#babel-preset-react" class="headerlink" title="@babel/preset-react"></a>@babel/preset-react</h4><p>è™½ç„¶ <code>@babel/preset-typescript</code> å°±èƒ½è½¬æ¢ tsx æˆ js ä»£ç ï¼Œä½†æ˜¯ <code>@babel/preset-react</code> è¿˜é›†æˆäº†ä¸€äº›é’ˆå¯¹ react é¡¹ç›®çš„å®ç”¨çš„æ’ä»¶ã€‚</p><p><code>@babel/preset-react</code> é»˜è®¤ä¼šå¼€å¯ä¸‹é¢è¿™äº›æ’ä»¶:</p><ul><li><span class="exturl" data-url="aHR0cHM6Ly9iYWJlbGpzLmlvL2RvY3MvZW4vYmFiZWwtcGx1Z2luLXN5bnRheC1qc3g=" title="https://babeljs.io/docs/en/babel-plugin-syntax-jsx">@babel/plugin-syntax-jsx<i class="fa fa-external-link"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9iYWJlbGpzLmlvL2RvY3MvZW4vYmFiZWwtcGx1Z2luLXRyYW5zZm9ybS1yZWFjdC1qc3g=" title="https://babeljs.io/docs/en/babel-plugin-transform-react-jsx">@babel/plugin-transform-react-jsx<i class="fa fa-external-link"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9iYWJlbGpzLmlvL2RvY3MvZW4vYmFiZWwtcGx1Z2luLXRyYW5zZm9ybS1yZWFjdC1kaXNwbGF5LW5hbWU=" title="https://babeljs.io/docs/en/babel-plugin-transform-react-display-name">@babel/plugin-transform-react-display-name<i class="fa fa-external-link"></i></span></li></ul><p>å¦‚æœè®¾ç½®äº† <code>development: true</code> è¿˜ä¼šå¼€å¯:</p><ul><li><span class="exturl" data-url="aHR0cHM6Ly9iYWJlbGpzLmlvL2RvY3MvZW4vYmFiZWwtcGx1Z2luLXRyYW5zZm9ybS1yZWFjdC1qc3gtc2VsZg==" title="https://babeljs.io/docs/en/babel-plugin-transform-react-jsx-self">@babel/plugin-transform-react-jsx-self<i class="fa fa-external-link"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9iYWJlbGpzLmlvL2RvY3MvZW4vYmFiZWwtcGx1Z2luLXRyYW5zZm9ybS1yZWFjdC1qc3gtc291cmNl" title="https://babeljs.io/docs/en/babel-plugin-transform-react-jsx-source">@babel/plugin-transform-react-jsx-source<i class="fa fa-external-link"></i></span></li></ul><p>å®‰è£…ä¾èµ– <code>@babel/preset-react</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add @babel/preset-react -D</span><br></pre></td></tr></table></figure><h4 id="react-hot-loader"><a href="#react-hot-loader" class="headerlink" title="react-hot-loader"></a>react-hot-loader</h4><p>ä¸ºäº†å®ç°ç»„ä»¶çš„å±€éƒ¨åˆ·æ–°ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£… <code>react-hot-loader</code> è¿™ä¸ª babel æ’ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add react-hot-loader</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ’ä»¶ä¸éœ€è¦å®‰è£…æˆ <code>devDependencies</code>ï¼Œå®ƒåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä¸ä¼šè¢«æ‰§è¡Œå¹¶ä¸”ä¼šç¡®ä¿å®ƒå ç”¨çš„ä½“ç§¯æœ€å°ã€‚å…¶å®å®˜æ–¹æ­£åœ¨å¼€å‘ä¸‹ä¸€ä»£çš„ react çƒ­æ›´æ–°æ’ä»¶ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL3JlYWN0L2lzc3Vlcy8xNjYwNA==" title="https://github.com/facebook/react/issues/16604">React Fast Refresh<i class="fa fa-external-link"></i></span>ï¼Œä¸è¿‡ç›®å‰è¿˜ä¸æ”¯æŒ webpackã€‚</p><p>ä¸ºäº†çœ‹åˆ°æµ‹è¯•æ•ˆæœï¼Œæˆ‘ä»¬å®‰è£… react å…¨å®¶æ¡¶å¹¶ä¸”è°ƒæ•´ä¸€ä¸‹ <code>src</code> æ–‡ä»¶å¤¹ä¸‹çš„é»˜è®¤å†…å®¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add react react-dom react-router-dom</span><br><span class="line">yarn add @types/react @types/react-dom @types/react-router-dom -D</span><br></pre></td></tr></table></figure><p><code>react</code> æ˜¯æ¡†æ¶æ ¸å¿ƒæ¥å£ï¼Œ<code>react-dom</code> è´Ÿè´£æŒ‚è½½æˆ‘ä»¬çš„ react ç»„ä»¶åˆ°çœŸå®çš„ DOM ä¸Šï¼Œ <code>react-dom-router</code> æ˜¯å®ç°äº† <code>react-router</code> æ¥å£çš„ web å¹³å°çš„è·¯ç”±åº“ã€‚</p><p>è®© <code>react-hot-loader</code> æ¥ç®¡æˆ‘ä»¬çš„ react æ ¹ç»„ä»¶ï¼Œå…¶å®è¿™ä¸ª hot å‡½æ•°å°±æ˜¯ä¸€ä¸ª <strong>hoc</strong> å˜›ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.ts</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; hot &#125; <span class="keyword">from</span> <span class="string">'react-hot-loader/root'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.scss'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"app"</span>&gt;</span><br><span class="line">      &lt;h2 className=<span class="string">"title"</span>&gt;react typescript boilerplate&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> hot(App);</span><br></pre></td></tr></table></figure><p>åœ¨ webpack entry åŠ å…¥çƒ­æ›´æ–°è¡¥ä¸ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> commonConfig: Configuration = &#123;</span><br><span class="line">  entry: [<span class="string">'react-hot-loader/patch'</span>, resolvePath(projectRoot, <span class="string">'./src/index.tsx'</span>)],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å®˜æ–¹æ–‡æ¡£æåˆ°å¦‚æœéœ€è¦æ”¯æŒ <code>react hooks</code> çš„çƒ­æ›´æ–°ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å®‰è£… <code>@hot-loader/react-dom</code>ï¼Œä½¿ç”¨å®ƒæ¥æ›¿æ¢é»˜è®¤çš„ <code>react-dom</code> æ¥æ·»åŠ ä¸€äº›é¢å¤–çš„çƒ­æ›´æ–°ç‰¹æ€§ï¼Œä¸ºäº†æ›¿æ¢ <code>react-dom</code> æˆ‘ä»¬éœ€è¦é…ç½® webpack aliasï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.common.ts</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      <span class="string">'react-dom'</span>: <span class="string">'@hot-loader/react-dom'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç»“åˆå‰é¢æåˆ° babel æ’ä»¶ï¼Œæœ€ç»ˆä¿®æ”¹ <code>babel.config.js</code> æˆï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> envPreset = [</span><br><span class="line">  <span class="string">'@babel/preset-env'</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// åªå¯¼å…¥éœ€è¦çš„ polyfill</span></span><br><span class="line">    useBuiltIns: <span class="string">'usage'</span>,</span><br><span class="line">    <span class="comment">// æŒ‡å®š corjs ç‰ˆæœ¬</span></span><br><span class="line">    corejs: <span class="number">3</span>,</span><br><span class="line">    <span class="comment">// ç¦ç”¨æ¨¡å—åŒ–æ–¹æ¡ˆè½¬æ¢</span></span><br><span class="line">    modules: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">api</span>) </span>&#123;</span><br><span class="line">  api.cache(<span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    presets: [<span class="string">'@babel/preset-typescript'</span>, envPreset],</span><br><span class="line">    plugins: [<span class="string">'@babel/plugin-transform-runtime'</span>],</span><br><span class="line">    env: &#123;</span><br><span class="line">      <span class="comment">// å¼€å‘ç¯å¢ƒé…ç½®</span></span><br><span class="line">      development: &#123;</span><br><span class="line">        presets: [[<span class="string">'@babel/preset-react'</span>, &#123; <span class="attr">development</span>: <span class="literal">true</span> &#125;]],</span><br><span class="line">        plugins: [<span class="string">'react-hot-loader/babel'</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// ç”Ÿäº§ç¯å¢ƒé…ç½®</span></span><br><span class="line">      production: &#123;</span><br><span class="line">        presets: [<span class="string">'@babel/preset-react'</span>],</span><br><span class="line">        plugins: [<span class="string">'@babel/plugin-transform-react-constant-elements'</span>, <span class="string">'@babel/plugin-transform-react-inline-elements'</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°æˆ‘ä»¬ç”Ÿäº§ç¯å¢ƒä¸‹è¿˜å®‰è£…äº†ä¸¤ä¸ªæ’ä»¶è¿›è¡Œç”Ÿäº§ç¯å¢ƒçš„ä¼˜åŒ–ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add @babel/plugin-transform-react-constant-elements @babel/plugin-transform-react-inline-elements -D</span><br></pre></td></tr></table></figure><p><code>@babel/plugin-transform-react-constant-elements</code> çš„ä½œç”¨æ˜¯åƒä¸‹é¢æ ·å°†å‡½æ•°ç»„ä»¶ä¸­çš„å˜é‡æå‡åˆ°å‡½æ•°å¤–æ¥é¿å…æ¯æ¬¡é‡æ–°è°ƒç”¨å‡½æ•°ç»„ä»¶é‡å¤å£°æ˜å’Œæ²¡å¿…è¦çš„åƒåœ¾å›æ”¶ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Hr = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">hr</span> <span class="attr">className</span>=<span class="string">"hr"</span> /&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è½¬æ¢æˆ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> _ref = <span class="xml"><span class="tag">&lt;<span class="name">hr</span> <span class="attr">className</span>=<span class="string">"hr"</span> /&gt;</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Hr = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> _ref;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>@babel/plugin-transform-react-inline-elements</code> çš„ä½œç”¨è¯»è€…å¯ä»¥å‚è€ƒ react çš„è¿™ä¸ª issueï¼š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL3JlYWN0L2lzc3Vlcy8zMjI4" title="https://github.com/facebook/react/issues/3228">Optimizing Compiler: Inline ReactElements<i class="fa fa-external-link"></i></span>ã€‚</p><h2 id="ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–"><a href="#ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–" class="headerlink" title="ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–"></a>ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–</h2><h3 id="æ·»åŠ ç‰ˆæƒå£°æ˜"><a href="#æ·»åŠ ç‰ˆæƒå£°æ˜" class="headerlink" title="æ·»åŠ ç‰ˆæƒå£°æ˜"></a>æ·»åŠ ç‰ˆæƒå£°æ˜</h3><p>è¿™ä¸ªç›´æ¥ç”¨ webpack å†…ç½®çš„ <code>BannerPlugin</code> å³å¯:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; BannerPlugin &#125; <span class="keyword">from</span> <span class="string">'webpack'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mergedConfig = merge(commonConfig, &#123;</span><br><span class="line">  mode: <span class="string">'production'</span>,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> BannerPlugin(&#123;</span><br><span class="line">      raw: <span class="literal">true</span>,</span><br><span class="line">      banner: <span class="string">`/** @preserve Powered by react-typescript-boilerplate (https://github.com/tjx666/react-typescript-boilerplate) */`</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><img data-src="https://i.loli.net/2020/02/20/DusmAYnTV2JL4Xv.png" alt="copyright"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬åœ¨ç‰ˆæƒå£°æ˜çš„æ³¨é‡Šä¸­åŠ äº† <code>@preserve</code> æ ‡è®°ï¼Œæˆ‘ä»¬åé¢ä¼šä½¿ç”¨ <code>terser</code> åœ¨ç”Ÿäº§ç¯å¢ƒæ„å»ºæ—¶å‹ç¼©ä»£ç ï¼Œå‹ç¼©ä»£ç æ—¶ä¼šå»æ‰æ‰€æœ‰æ³¨é‡Šï¼Œé™¤äº†ä¸€äº›åŒ…å«ç‰¹æ®Šæ ‡è®°çš„æ³¨é‡Šï¼Œä¾‹å¦‚æˆ‘ä»¬æ·»åŠ çš„ <code>@preserve</code>ã€‚</p><h3 id="CSS-æ‹†åˆ†"><a href="#CSS-æ‹†åˆ†" class="headerlink" title="CSS æ‹†åˆ†"></a>CSS æ‹†åˆ†</h3><p>å¦‚æœ CSS æ˜¯åŒ…å«åœ¨æˆ‘ä»¬æ‰“åŒ…çš„ JS bundle ä¸­é‚£ä¼šå¯¼è‡´æœ€åä½“ç§¯å¾ˆå¤§ï¼Œä¸¥é‡æƒ…å†µä¸‹è®¿é—®é¦–é¡µä¼šé€ æˆçŸ­æš‚çš„ç™½å±ã€‚æ‹†åˆ† CSS æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dlYnBhY2stY29udHJpYi9taW5pLWNzcy1leHRyYWN0LXBsdWdpbg==" title="https://github.com/webpack-contrib/mini-css-extract-plugin">mini-css-extract-plugin<i class="fa fa-external-link"></i></span>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add mini-css-extract-plugin -D</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.prod.ts</span></span><br><span class="line"><span class="keyword">import</span> MiniCssExtractPlugin <span class="keyword">from</span> <span class="string">'mini-css-extract-plugin'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> prodConfig = merge(commonConfig, &#123;</span><br><span class="line">  mode: <span class="string">'production'</span>,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">      <span class="comment">// æ–‡ä»¶åä¸­æ’å…¥æ–‡ä»¶å†…å®¹çš„ hash å€¼</span></span><br><span class="line">      filename: <span class="string">'css/[name].[contenthash].css'</span>,</span><br><span class="line">      chunkFilename: <span class="string">'css/[id].[contenthash].css'</span>,</span><br><span class="line">      ignoreOrder: <span class="literal">false</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dlYnBhY2stY29udHJpYi9taW5pLWNzcy1leHRyYWN0LXBsdWdpbg==" title="https://github.com/webpack-contrib/mini-css-extract-plugin">mini-css-extract-plugin<i class="fa fa-external-link"></i></span> è¿˜æä¾›äº† <code>mini-css-extract-plugin.loader</code>ï¼Œå®ƒä¸èƒ½å’Œ <code>style-loader</code> å…±å­˜ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¿®æ”¹ <code>webpack.common.ts</code> çš„é…ç½®ä½¿å¾—å¼€å‘ç¯å¢ƒä¸‹ä½¿ç”¨ <code>style-loader</code> ç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨ <code>mini-css-extract-plugin.loader</code>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; loader <span class="keyword">as</span> MiniCssExtractLoader &#125; <span class="keyword">from</span> <span class="string">'mini-css-extract-plugin'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; __DEV__ &#125; <span class="keyword">from</span> <span class="string">'../env'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCssLoaders</span>(<span class="params">importLoaders: number</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    __DEV__ ? <span class="string">'style-loader'</span> : MiniCssExtractLoader,</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">'css-loader'</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        modules: <span class="literal">false</span>,</span><br><span class="line">        sourceMap: <span class="literal">true</span>,</span><br><span class="line">        importLoaders,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">'postcss-loader'</span>,</span><br><span class="line">      options: &#123; <span class="attr">sourceMap</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä»£ç å‹ç¼©"><a href="#ä»£ç å‹ç¼©" class="headerlink" title="ä»£ç å‹ç¼©"></a>ä»£ç å‹ç¼©</h3><h4 id="JavaScript-å‹ç¼©"><a href="#JavaScript-å‹ç¼©" class="headerlink" title="JavaScript å‹ç¼©"></a>JavaScript å‹ç¼©</h4><p>ç½‘ä¸Šå¾ˆå¤šæ•™ç¨‹åœ¨è®² webpack å‹ç¼©ä»£ç çš„æ—¶å€™éƒ½æ˜¯ä½¿ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dlYnBhY2stY29udHJpYi91Z2xpZnlqcy13ZWJwYWNrLXBsdWdpbg==" title="https://github.com/webpack-contrib/uglifyjs-webpack-plugin">uglifyjs-webpack-plugin<i class="fa fa-external-link"></i></span>ï¼Œå…¶å®è¿™ä¸ªä»“åº“æ—©å°±æ”¾å¼ƒç»´æŠ¤äº†ï¼Œè€Œä¸”å®ƒä¸æ”¯æŒ ES6 è¯­æ³•ï¼Œwebpack çš„æ ¸å¿ƒå¼€å‘è€… <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2V2aWxlYm90dG5hd2k=" title="https://github.com/evilebottnawi">evilebottnawi<i class="fa fa-external-link"></i></span> éƒ½è½¬å‘ç»´æŠ¤ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dlYnBhY2stY29udHJpYi90ZXJzZXItd2VicGFjay1wbHVnaW4=" title="https://github.com/webpack-contrib/terser-webpack-plugin">terser-webpack-plugin<i class="fa fa-external-link"></i></span> äº†ã€‚æˆ‘ä»¬ä½¿ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dlYnBhY2stY29udHJpYi90ZXJzZXItd2VicGFjay1wbHVnaW4=" title="https://github.com/webpack-contrib/terser-webpack-plugin">terser-webpack-plugin<i class="fa fa-external-link"></i></span> åœ¨ç”Ÿäº§ç¯å¢ƒå¯¹ä»£ç è¿›è¡Œå‹ç¼©ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ webpack4 æ–°å¢çš„ <span class="exturl" data-url="aHR0cHM6Ly93d3cud2VicGFja2pzLmNvbS9ndWlkZXMvdHJlZS1zaGFraW5nLw==" title="https://www.webpackjs.com/guides/tree-shaking/">tree-shaking<i class="fa fa-external-link"></i></span> å»é™¤ä»£ç ä¸­çš„æ­»ä»£ç ï¼Œè¿›ä¸€æ­¥å‡å° bundle ä½“ç§¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add terser-webpack-plugin @types/terser-webpack-plugin -D</span><br></pre></td></tr></table></figure><p>treeshake éœ€è¦åœ¨ <code>package.json</code> ä¸­é…ç½® <code>sideEffects</code> å­—æ®µï¼Œè¯¦æƒ…å¯ä»¥é˜…è¯»å®˜æ–¹æ–‡æ¡£ï¼š<span class="exturl" data-url="aHR0cHM6Ly93ZWJwYWNrLmpzLm9yZy9ndWlkZXMvdHJlZS1zaGFraW5nLw==" title="https://webpack.js.org/guides/tree-shaking/">Tree Shaking<i class="fa fa-external-link"></i></span>ã€‚</p><h4 id="CSS-å‹ç¼©"><a href="#CSS-å‹ç¼©" class="headerlink" title="CSS å‹ç¼©"></a>CSS å‹ç¼©</h4><p>å‹ç¼© CSS ä½¿ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL05NRlIvb3B0aW1pemUtY3NzLWFzc2V0cy13ZWJwYWNrLXBsdWdpbg==" title="https://github.com/NMFR/optimize-css-assets-webpack-plugin">optimize-css-assets-webpack-plugin<i class="fa fa-external-link"></i></span>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add optimize-css-assets-webpack-plugin @types/optimize-css-assets-webpack-plugin -D</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ <code>webpack.prod.ts</code>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> TerserPlugin <span class="keyword">from</span> <span class="string">'terser-webpack-plugin'</span>;</span><br><span class="line"><span class="keyword">import</span> OptimizeCSSAssetsPlugin <span class="keyword">from</span> <span class="string">'optimize-css-assets-webpack-plugin'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> prodConfig = merge(commonConfig, &#123;</span><br><span class="line">  mode: <span class="string">'production'</span>,</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ minimizer è€Œä¸æ˜¯é»˜è®¤çš„ uglifyJS</span></span><br><span class="line">    minimize: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// ä¸¤ä¸ª minimizerï¼šTerserPlugin å’Œ OptimizeCSSAssetsPlugin</span></span><br><span class="line">    minimizer: [<span class="keyword">new</span> TerserPlugin(&#123; <span class="attr">extractComments</span>: <span class="literal">false</span> &#125;), <span class="keyword">new</span> OptimizeCSSAssetsPlugin()],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="æ„å»ºåˆ†æ"><a href="#æ„å»ºåˆ†æ" class="headerlink" title="æ„å»ºåˆ†æ"></a>æ„å»ºåˆ†æ</h3><p>æˆ‘ä»¬æ·»åŠ ä¸€äº› webpack æ’ä»¶ç”¨æ¥è¿›è¡Œæ„å»ºåˆ†æ</p><h4 id="æ—¶é—´ç»Ÿè®¡"><a href="#æ—¶é—´ç»Ÿè®¡" class="headerlink" title="æ—¶é—´ç»Ÿè®¡"></a>æ—¶é—´ç»Ÿè®¡</h4><p><img data-src="https://i.loli.net/2020/02/19/c1vdoqsT34WCSHX.png" alt="speed measure"></p><p>æˆ‘ä»¬ä½¿ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N0ZXBoZW5jb29rZGV2L3NwZWVkLW1lYXN1cmUtd2VicGFjay1wbHVnaW4=" title="https://github.com/stephencookdev/speed-measure-webpack-plugin">speed-measure-webpack-plugin<i class="fa fa-external-link"></i></span> å¯¹æ‰“åŒ…æ—¶é—´è¿›è¡Œç»Ÿè®¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add speed-measure-webpack-plugin -D</span><br></pre></td></tr></table></figure><p>é¡¹ç›®è¿›è¡Œåˆ°è¿™ï¼Œæˆ‘ä»¬ç»ˆäºç¢°åˆ°ç¬¬ä¸€ä¸ªæ²¡æœ‰ TypeScript ç±»å‹å£°æ˜æ–‡ä»¶çš„åº“äº†ï¼Œæ–°å»º <code>scripts/typings/index.d.ts</code> æ–‡ä»¶ï¼Œå› ä¸ºéœ€è¦ç¼–å†™çš„ç±»å‹å¾ˆå°‘ï¼Œ<code>index.d.ts</code> å°±ä½œä¸ºä¸€ä¸ªå…¨å±€å£°æ˜æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­æ·»åŠ  <code>speed-measure-webpack-plugin</code> çš„å¤–éƒ¨æ¨¡å—å£°æ˜ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// scripts/typings/index.d.ts</span></span><br><span class="line">declare <span class="built_in">module</span> <span class="string">'speed-measure-webpack-plugin'</span> &#123;</span><br><span class="line">    <span class="keyword">import</span> &#123; Configuration, Plugin &#125; <span class="keyword">from</span> <span class="string">'webpack'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œéœ€è¦å“ªäº›é€‰é¡¹å°±å£°æ˜å“ªäº›é€‰é¡¹å°±è¡Œ</span></span><br><span class="line">  	<span class="comment">// å¯ä»¥çœ‹å‡º TypeScript æ˜¯éå¸¸çµæ´»çš„</span></span><br><span class="line">    interface SpeedMeasurePluginOptions &#123;</span><br><span class="line">        disable: boolean;</span><br><span class="line">        outputFormat: <span class="string">'json'</span> | <span class="string">'human'</span> | <span class="string">'humanVerbose'</span> | <span class="function">(<span class="params">(outputObj: object</span>) =&gt;</span> <span class="keyword">void</span>);</span><br><span class="line">        outputTarget: string | <span class="function">(<span class="params">(outputObj: string</span>) =&gt;</span> <span class="keyword">void</span>);</span><br><span class="line">        pluginNames: object;</span><br><span class="line">        granularLoaderData: boolean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»§æ‰¿ Plugin ç±», Plugin ç±»éƒ½æœ‰ apply æ–¹æ³•</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">SpeedMeasurePlugin</span> <span class="keyword">extends</span> <span class="title">Plugin</span> </span>&#123;</span><br><span class="line">        <span class="keyword">constructor</span>(options?: Partial&lt;SpeedMeasurePluginOptions&gt;);</span><br><span class="line">        wrap(webpackConfig: Configuration): Configuration;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    export = SpeedMeasurePlugin;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ <code>webpack.prod.ts</code>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SpeedMeasurePlugin <span class="keyword">from</span> <span class="string">'speed-measure-webpack-plugin'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mergedConfig = merge(commonConfig, &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> smp = <span class="keyword">new</span> SpeedMeasurePlugin();</span><br><span class="line"><span class="keyword">const</span> prodConfig = smp.wrap(mergedConfig);</span><br></pre></td></tr></table></figure><h4 id="bundle-åˆ†æ"><a href="#bundle-åˆ†æ" class="headerlink" title="bundle åˆ†æ"></a>bundle åˆ†æ</h4><p><img data-src="https://i.loli.net/2020/02/19/Plifd7e9b2WOxsF.png" alt="bundle analyze"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add BundleAnalyzerPlugin @types/BundleAnalyzerPlugin -D</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ·»åŠ ä¸€ä¸ª npm script ç”¨äºå¸¦ bundle åˆ†æçš„æ„å»ºï¼Œå› ä¸ºæœ‰äº›æ—¶å€™æˆ‘ä»¬å¹¶ä¸æƒ³æ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨å»åˆ†æå„ä¸ªæ¨¡å—çš„å¤§å°å’Œå æ¯”ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"build"</span>: <span class="string">"cross-env-shell NODE_ENV=production ts-node --files -P scripts/tsconfig.json scripts/build"</span>,</span><br><span class="line">    <span class="string">"build-analyze"</span>: <span class="string">"cross-env-shell NODE_ENV=production ts-node --files -P scripts/tsconfig.json scripts/build --analyze"</span>,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ <code>webpack.prod.ts</code>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ·»åŠ </span></span><br><span class="line"><span class="keyword">import</span> &#123; isAnalyze &#125; <span class="keyword">from</span> <span class="string">'../env'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (isAnalyze) &#123;</span><br><span class="line">    mergedConfig.plugins!.push(<span class="keyword">new</span> BundleAnalyzerPlugin());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å½“æˆ‘ä»¬æƒ³çœ‹å„ä¸ªæ¨¡å—åœ¨ bundle ä¸­çš„å¤§å°å’Œå æ¯”çš„æ—¶å€™å¯ä»¥è¿è¡Œ <code>npm run build-analyze</code>ï¼Œå°†ä¼šè‡ªåŠ¨åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ä¸Šå›¾ä¸­çš„é¡µé¢ã€‚</p><h4 id="å‡†å¤‡-gzip-å‹ç¼©ç‰ˆæœ¬"><a href="#å‡†å¤‡-gzip-å‹ç¼©ç‰ˆæœ¬" class="headerlink" title="å‡†å¤‡ gzip å‹ç¼©ç‰ˆæœ¬"></a>å‡†å¤‡ gzip å‹ç¼©ç‰ˆæœ¬</h4><p>æˆ‘ä»¬ä½¿ç”¨å®˜æ–¹ç»´æŠ¤çš„ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dlYnBhY2stY29udHJpYi9jb21wcmVzc2lvbi13ZWJwYWNrLXBsdWdpbg==" title="https://github.com/webpack-contrib/compression-webpack-plugin">compression-webpack-plugin<i class="fa fa-external-link"></i></span> æ¥ä¸ºæ‰“åŒ…å‡ºæ¥çš„å„ä¸ªæ–‡ä»¶å‡†å¤‡ gzip å‹ç¼©ç‰ˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add compression-webpack-plugin @types/compression-webpack-plugin -D</span><br></pre></td></tr></table></figure><h4 id="è·Ÿè¸ª-gzip-åçš„èµ„æºå¤§å°"><a href="#è·Ÿè¸ª-gzip-åçš„èµ„æºå¤§å°" class="headerlink" title="è·Ÿè¸ª gzip åçš„èµ„æºå¤§å°"></a>è·Ÿè¸ª gzip åçš„èµ„æºå¤§å°</h4><p><img data-src="https://i.loli.net/2020/02/19/Oteqp9js3DPFrCS.png" alt="trace size"></p><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0dvb2dsZUNocm9tZUxhYnMvc2l6ZS1wbHVnaW4=" title="https://github.com/GoogleChromeLabs/size-plugin">size-plugin<i class="fa fa-external-link"></i></span> æ˜¯è°·æ­Œå‡ºå“çš„ä¸€ä¸ªæ˜¾ç¤º webpack å„ä¸ª chunk gzip å‹ç¼©åçš„ä½“ç§¯å¤§å°ä»¥åŠç›¸æ¯”äºä¸Šä¸€æ¬¡çš„å¤§å°å˜åŒ–ï¼Œä¸Šå›¾ä¸­çº¢æ¡†ä¸­çš„éƒ¨åˆ†æ˜¾ç¤ºäº†æˆ‘åŠ äº†ä¸€å¥ log ä¹‹å gizip ä½“ç§¯å¢åŠ äº† 11Bã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add size-plugin -D</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªåº“æœ‰æ²¡æœ‰å®˜æ–¹çš„ types æ–‡ä»¶ï¼Œæˆ‘ä»¬æ·»åŠ  <code>size-plugin</code> çš„å¤–éƒ¨æ¨¡å—å£°æ˜ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// scripts/typings/index.d.ts</span></span><br><span class="line">declare <span class="built_in">module</span> <span class="string">'size-plugin'</span> &#123;</span><br><span class="line">    <span class="keyword">import</span> &#123; Plugin &#125; <span class="keyword">from</span> <span class="string">'webpack'</span>;</span><br><span class="line"></span><br><span class="line">    interface SizePluginOptions &#123;</span><br><span class="line">        pattern: string;</span><br><span class="line">        exclude: string;</span><br><span class="line">        filename: string;</span><br><span class="line">        publish: boolean;</span><br><span class="line">        writeFile: boolean;</span><br><span class="line">        stripHash: <span class="built_in">Function</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">SizePlugin</span> <span class="keyword">extends</span> <span class="title">Plugin</span> </span>&#123;</span><br><span class="line">        <span class="keyword">constructor</span>(options?: Partial&lt;SizePluginOptions&gt;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    export = SizePlugin;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.prod.ts</span></span><br><span class="line"><span class="keyword">const</span> mergedConfig = merge(commonConfig, &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// ä¸è¾“å‡ºæ–‡ä»¶å¤§å°åˆ°ç£ç›˜</span></span><br><span class="line">    <span class="keyword">new</span> SizePlugin(&#123; <span class="attr">writeFile</span>: <span class="literal">false</span> &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ€è¿‘åˆšå­¦ä¼šä¸€ä¸ªè¯ <code>TL; DR</code>ï¼Œå…¶å®å°±æ˜¯ï¼š</p><blockquote><p>Too long; didnâ€™t read.</p></blockquote><p>å…¶å®æˆ‘è‡ªå·±ä¹Ÿæ˜¯ç»å¸¸è¿™æ ·ï¼Œå“ˆå“ˆã€‚åˆ°è¿™é‡Œå·²ç»æœ‰ 1 ä¸‡å¤šå­—äº†ï¼Œæˆ‘ä¼°è®¡åº”è¯¥æ²¡å‡ ä¸ªäººä¼šçœ‹åˆ°è¿™ã€‚æ•´ä¸ªæµç¨‹èµ°ä¸‹æ¥æˆ‘è§‰å¾—æ˜¯è¿˜æ˜¯éå¸¸è‡ªç„¶çš„ï¼Œä»å¼€å‘ç¯å¢ƒåˆ°ç”Ÿäº§ç¯å¢ƒï¼Œä»åŸºæœ¬çš„é…ç½®åˆ°ä¼˜åŒ–æ§åˆ¶å°æ˜¾ç¤ºï¼Œå‡†å¤‡ gzip å‹ç¼©ç‰ˆæœ¬è¿™äº›é”¦ä¸Šæ·»èŠ±çš„æ­¥éª¤ã€‚å†™è¿™ç¯‡æ–‡ç« å…¶å®å¤§éƒ¨åˆ†çš„æ—¶é—´éƒ½èŠ±è´¹åœ¨äº†æŸ¥é˜…èµ„æ–™ä¸Šï¼Œæ¯ä¸€ä¸ªæ’ä»¶æˆ‘éƒ½å°½é‡æè¿°å¥½å®ƒä»¬çš„ä½œç”¨ï¼Œå¦‚æœæœ‰å€¼å¾—æ³¨æ„çš„åœ°æ–¹æˆ‘ä¹Ÿä¼šåœ¨ä»£ç æ³¨é‡Šä¸­æˆ–è€…æ–‡å­—æè¿°ä¸­æå‡ºæ¥ã€‚æˆ‘çŸ¥é“å¯èƒ½è¿™ç¯‡æ–‡ç« å¯¹äºä¸€äº›åŸºç¡€æ¯”è¾ƒå·®æˆ–è€…æ²¡æ€ä¹ˆæ‰‹åŠ¨é…ç½®è¿‡ webpack çš„åŒå­¦å‹åŠ›æ¯”è¾ƒå¤§ï¼Œå¾ˆå¯èƒ½çœ‹ä¸ä¸‹å»ï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼Œæˆ‘ä»¥å‰ä¹Ÿæ˜¯è¿™æ ·ï¼Œä¸è¿‡æˆ‘è§‰å¾—ä½ å¦‚æœèƒ½å¤Ÿå’¬å’¬ç‰™åšæŒè¯»å®Œï¼Œå°½ç®¡å¾ˆå¤šåœ°æ–¹çœ‹ä¸æ‡‚ï¼Œä½ æ€»æ˜¯ä¼šä»ä¸­å­¦åˆ°ä¸€äº›å¯¹ä½ æœ‰ç”¨çš„ä¸œè¥¿ï¼Œæˆ–è€…ä½ ä¹Ÿå¯ä»¥æ”¶è—ä¸‹æ¥å½“è‡ªå­—å…¸æ¥æŸ¥ã€‚è¿™ç¯‡æ–‡ç« å¾ˆå¤šé…ç½®å¹¶ä¸æ˜¯å’Œ react+typescript å¼ºè€¦åˆçš„ï¼Œä½ åŠ ä¸€ä¸ª vue-loader ä¸å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨ vue æ¥å¼€å‘äº†å—ï¼Ÿ<strong>æ›´é‡è¦çš„æ˜¯æˆ‘å¸Œæœ›ä¸€äº›è¯»è€…å¯ä»¥ä»ä¸­å­¦åˆ°æ¢ç´¢ç²¾ç¥ï¼Œå¯æ€•ä¸ä»£è¡¨ä¸å¯èƒ½ï¼Œå®è·µæ¢ç´¢æ‰èƒ½æŒæ¡çœŸçŸ¥ã€‚</strong></p><p>æœ€åæˆ‘ä»¬åŠ ä¸Šæˆ‘ä»¬çš„æ„å»ºè„šæœ¬ <code>build.ts</code>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// scripts/build.ts</span></span><br><span class="line"><span class="keyword">import</span> webpack <span class="keyword">from</span> <span class="string">'webpack'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> prodConfig <span class="keyword">from</span> <span class="string">'./configs/webpack.prod'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isAnalyze &#125; <span class="keyword">from</span> <span class="string">'./env'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> compiler = webpack(prodConfig);</span><br><span class="line"></span><br><span class="line">compiler.run(<span class="function">(<span class="params">error, stats</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (error) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(error);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> prodStatsOpts = &#123;</span><br><span class="line">    preset: <span class="string">'normal'</span>,</span><br><span class="line">    modules: isAnalyze,</span><br><span class="line">    colors: <span class="literal">true</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(stats.toString(prodStatsOpts));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><img data-src="https://i.loli.net/2020/02/19/ecaJjBtpHIEQoxC.gif" alt="effect"></p><p>æˆ‘æœ€è¿‘ä¸€ç›´åœ¨å¿™æ¯•ä¸šå’Œæ‰¾å·¥ä½œçš„äº‹æƒ…ï¼Œä¸‹ä¸€ç¯‡å¯èƒ½è¦åœ¨ä¸€ä¸ªæœˆåå·¦å³äº†ã€‚å¦‚æœè¯»è€…å¯¹æ–‡ç« ä¸­æœ‰å“ªäº›ä¸ç†è§£çš„åœ°æ–¹å»ºè®®å…ˆå»çœ‹ä¸‹<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RqeDY2Ni9yZWFjdC10eXBlc2NyaXB0LWJvaWxlcnBsYXRl" title="https://github.com/tjx666/react-typescript-boilerplate">æºä»£ç <i class="fa fa-external-link"></i></span>ï¼Œè¿˜æœ‰é—®é¢˜çš„è¯å¯ä»¥åœ¨ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RqeDY2Ni9yZWFjdC10eXBlc2NyaXB0LWJvaWxlcnBsYXRlL2lzc3Vlcw==" title="https://github.com/tjx666/react-typescript-boilerplate/issues">github issues<i class="fa fa-external-link"></i></span> æˆ–è€…å‘å¸ƒå¹³å°çš„è¯„è®ºåŒºå‘æˆ‘æé—®ï¼Œå¦‚æœè§‰å¾—æœ¬æ–‡å¯¹ä½ æœ‰ç”¨ï¼Œä¸å¦¨èµé¢— star ğŸ˜ã€‚</p><p>ä¸‹ä¸€ç¯‡åº”è¯¥ä¼šè®²è¿°å¦‚ä½•é›†æˆ <code>ant design</code>ï¼Œ<code>lodash</code> ç­‰æµè¡Œåº“å¹¶å¯¹å®ƒä»¬çš„æ‰“åŒ…è¿›è¡Œä¼˜åŒ–â€¦</p><p>æœ¬æ–‡ä¸ºåŸåˆ›å†…å®¹ï¼Œé¦–å‘äº<span class="exturl" data-url="aHR0cDovL3d3dy5seXJlYWw2NjYuY29tLw==" title="http://www.lyreal666.com/">ä¸ªäººåšå®¢<i class="fa fa-external-link"></i></span>ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p></div><p style="text-align:center">ï¼ˆå®Œï¼‰</p><footer class="post-footer"><div class="post-tags"><a href="/tags/react/" rel="tag"><i class="fa fa-tag"></i> react</a> <a href="/tags/typescript/" rel="tag"><i class="fa fa-tag"></i> typescript</a> <a href="/tags/webpack/" rel="tag"><i class="fa fa-tag"></i> webpack</a> <a href="/tags/express/" rel="tag"><i class="fa fa-tag"></i> express</a> <a href="/tags/babel/" rel="tag"><i class="fa fa-tag"></i> babel</a></div><div class="post-nav"><div class="post-nav-item"><a href="/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E9%85%8D%E7%BD%AE-react-typescript%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9Alinters-%E5%92%8C-formatter/" rel="prev" title="ä»é›¶å¼€å§‹é…ç½® react + typescriptï¼ˆäºŒï¼‰ï¼šlinters å’Œ formatter"><i class="fa fa-chevron-left"></i> ä»é›¶å¼€å§‹é…ç½® react + typescriptï¼ˆäºŒï¼‰ï¼šlinters å’Œ formatter</a></div><div class="post-nav-item"><a href="/%E9%82%A3%E4%BA%9B%E4%BD%A0%E5%BA%94%E8%AF%A5%E8%80%83%E8%99%91%E5%8D%B8%E8%BD%BD%E7%9A%84-VSCode-%E6%89%A9%E5%B1%95/" rel="next" title="é‚£äº›ä½ åº”è¯¥è€ƒè™‘å¸è½½çš„ VSCode æ‰©å±•">é‚£äº›ä½ åº”è¯¥è€ƒè™‘å¸è½½çš„ VSCode æ‰©å±• <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><script>window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">æ–‡ç« ç›®å½•</li><li class="sidebar-nav-overview">ç«™ç‚¹æ¦‚è§ˆ</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#dev-server"><span class="nav-number">1.</span> <span class="nav-text">dev server</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#æŠ€æœ¯é€‰å‹"><span class="nav-number">1.1.</span> <span class="nav-text">æŠ€æœ¯é€‰å‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å®ç°æœ€åŸºæœ¬çš„æ‰“åŒ…åŠŸèƒ½"><span class="nav-number">1.2.</span> <span class="nav-text">å®ç°æœ€åŸºæœ¬çš„æ‰“åŒ…åŠŸèƒ½</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#é…ç½®å…¥å£æ–‡ä»¶"><span class="nav-number">1.2.1.</span> <span class="nav-text">é…ç½®å…¥å£æ–‡ä»¶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ç¼–è¯‘-TypeScript"><span class="nav-number">1.2.2.</span> <span class="nav-text">ç¼–è¯‘ TypeScript</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ·»åŠ -webpack-é…ç½®"><span class="nav-number">1.2.3.</span> <span class="nav-text">æ·»åŠ  webpack é…ç½®</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ä½¿ç”¨-express-å¼€å‘-devServer"><span class="nav-number">1.2.4.</span> <span class="nav-text">ä½¿ç”¨ express å¼€å‘ devServer</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å¼€å‘ç¯å¢ƒä¼˜åŒ–"><span class="nav-number">2.</span> <span class="nav-text">å¼€å‘ç¯å¢ƒä¼˜åŒ–</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#plugins"><span class="nav-number">2.1.</span> <span class="nav-text">plugins</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#æ˜¾ç¤ºæ‰“åŒ…è¿›åº¦"><span class="nav-number">2.1.1.</span> <span class="nav-text">æ˜¾ç¤ºæ‰“åŒ…è¿›åº¦</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ä¼˜åŒ–æ§åˆ¶å°è¾“å‡º"><span class="nav-number">2.1.2.</span> <span class="nav-text">ä¼˜åŒ–æ§åˆ¶å°è¾“å‡º</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ„å»ºé€šçŸ¥"><span class="nav-number">2.1.3.</span> <span class="nav-text">æ„å»ºé€šçŸ¥</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ä¸¥æ ¼æ£€æŸ¥è·¯å¾„å¤§å°å†™"><span class="nav-number">2.1.4.</span> <span class="nav-text">ä¸¥æ ¼æ£€æŸ¥è·¯å¾„å¤§å°å†™</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å¾ªç¯ä¾èµ–æ£€æŸ¥"><span class="nav-number">2.1.5.</span> <span class="nav-text">å¾ªç¯ä¾èµ–æ£€æŸ¥</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ¸…ç†ä¸Šæ¬¡æ‰“åŒ…çš„-bundle"><span class="nav-number">2.1.6.</span> <span class="nav-text">æ¸…ç†ä¸Šæ¬¡æ‰“åŒ…çš„ bundle</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#è‡ªåŠ¨ç”Ÿæˆ-index-html"><span class="nav-number">2.1.7.</span> <span class="nav-text">è‡ªåŠ¨ç”Ÿæˆ index.html</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ‹·è´æ–‡ä»¶åˆ°-dist"><span class="nav-number">2.1.8.</span> <span class="nav-text">æ‹·è´æ–‡ä»¶åˆ° dist</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ£€æŸ¥-TypeScript-ç±»å‹"><span class="nav-number">2.1.9.</span> <span class="nav-text">æ£€æŸ¥ TypeScript ç±»å‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ç¼“å­˜ç¥å™¨"><span class="nav-number">2.1.10.</span> <span class="nav-text">ç¼“å­˜ç¥å™¨</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#loaders"><span class="nav-number">2.2.</span> <span class="nav-text">loaders</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å¤„ç†æ ·å¼æ–‡ä»¶"><span class="nav-number">2.2.1.</span> <span class="nav-text">å¤„ç†æ ·å¼æ–‡ä»¶</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#CSS"><span class="nav-number">2.2.1.1.</span> <span class="nav-text">CSS</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#less"><span class="nav-number">2.2.1.2.</span> <span class="nav-text">less</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#sass"><span class="nav-number">2.2.1.3.</span> <span class="nav-text">sass</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#postcss"><span class="nav-number">2.2.1.4.</span> <span class="nav-text">postcss</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å¤„ç†å›¾ç‰‡å’Œå­—ä½“"><span class="nav-number">2.2.2.</span> <span class="nav-text">å¤„ç†å›¾ç‰‡å’Œå­—ä½“</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sourcemap"><span class="nav-number">2.3.</span> <span class="nav-text">sourcemap</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#çƒ­æ›´æ–°"><span class="nav-number">2.4.</span> <span class="nav-text">çƒ­æ›´æ–°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#babel-é…ç½®ä¼˜åŒ–"><span class="nav-number">2.5.</span> <span class="nav-text">babel é…ç½®ä¼˜åŒ–</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#babel-preset-env"><span class="nav-number">2.5.1.</span> <span class="nav-text">@babel&#x2F;preset-env</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#babel-plugin-transform-runtime"><span class="nav-number">2.5.2.</span> <span class="nav-text">@babel&#x2F;plugin-transform-runtime</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#babel-preset-react"><span class="nav-number">2.5.3.</span> <span class="nav-text">@babel&#x2F;preset-react</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#react-hot-loader"><span class="nav-number">2.5.4.</span> <span class="nav-text">react-hot-loader</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–"><span class="nav-number">3.</span> <span class="nav-text">ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#æ·»åŠ ç‰ˆæƒå£°æ˜"><span class="nav-number">3.1.</span> <span class="nav-text">æ·»åŠ ç‰ˆæƒå£°æ˜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CSS-æ‹†åˆ†"><span class="nav-number">3.2.</span> <span class="nav-text">CSS æ‹†åˆ†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä»£ç å‹ç¼©"><span class="nav-number">3.3.</span> <span class="nav-text">ä»£ç å‹ç¼©</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#JavaScript-å‹ç¼©"><span class="nav-number">3.3.1.</span> <span class="nav-text">JavaScript å‹ç¼©</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CSS-å‹ç¼©"><span class="nav-number">3.3.2.</span> <span class="nav-text">CSS å‹ç¼©</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ„å»ºåˆ†æ"><span class="nav-number">3.4.</span> <span class="nav-text">æ„å»ºåˆ†æ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#æ—¶é—´ç»Ÿè®¡"><span class="nav-number">3.4.1.</span> <span class="nav-text">æ—¶é—´ç»Ÿè®¡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#bundle-åˆ†æ"><span class="nav-number">3.4.2.</span> <span class="nav-text">bundle åˆ†æ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å‡†å¤‡-gzip-å‹ç¼©ç‰ˆæœ¬"><span class="nav-number">3.4.3.</span> <span class="nav-text">å‡†å¤‡ gzip å‹ç¼©ç‰ˆæœ¬</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#è·Ÿè¸ª-gzip-åçš„èµ„æºå¤§å°"><span class="nav-number">3.4.4.</span> <span class="nav-text">è·Ÿè¸ª gzip åçš„èµ„æºå¤§å°</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ€»ç»“"><span class="nav-number">4.</span> <span class="nav-text">æ€»ç»“</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="ä½™è…¾é–" src="/images/avatar.png"><p class="site-author-name" itemprop="name">ä½™è…¾é–</p><div class="site-description" itemprop="description">æ€»ç»“å’Œåˆ†äº«æˆ‘çš„æ‰€å­¦æ‰€æ€</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">æ—¥å¿—</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">5</span> <span class="site-state-item-name">åˆ†ç±»</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">23</span> <span class="site-state-item-name">æ ‡ç­¾</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS95dS10ZW5nLWppbmcvYWN0aXZpdGllcw==" title="çŸ¥ä¹ â†’ https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;yu-teng-jing&#x2F;activities"><i class="fa fa-fw fa-bookmark"></i>çŸ¥ä¹</span> </span><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uaW0vdXNlci81YWQwZGNhYTZmYjlhMDI4ZDkzNzk0Yjk=" title="æ˜é‡‘ â†’ https:&#x2F;&#x2F;juejin.im&#x2F;user&#x2F;5ad0dcaa6fb9a028d93794b9"><i class="fa fa-fw fa-book"></i>æ˜é‡‘</span> </span><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RqeDY2Ng==" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;tjx666"><i class="fa fa-fw fa-github"></i>GitHub</span> </span><span class="links-of-author-item"><span class="exturl" data-url="bWFpbHRvOnl0ajI3MTMxNTE3MTNAZ21haWwuY29t" title="E-Mail â†’ mailto:ytj2713151713@gmail.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</span> </span><span class="links-of-author-item"><a href="/atom.xml" title="RSS â†’ &#x2F;atom.xml"><i class="fa fa-fw fa-rss"></i>RSS</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2019 â€“ <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">ä½™è…¾é–</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="æ€»è®¿å®¢é‡"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-divider">|</span> <span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="æ€»è®¿é—®é‡"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/js/local-search.js"></script><script>if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme: 'forest',
      logLevel: 3,
      flowchart: { curve: 'linear' },
      gantt: { axisFormat: '%m/%d/%Y' },
      sequence: { actorMargin: 50 }
    });
  }, window.mermaid);
}</script></body></html>